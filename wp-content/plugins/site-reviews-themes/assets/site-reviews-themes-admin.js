/*! For license information please see site-reviews-themes-admin.js.LICENSE.txt */
!function(){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=Array(t);i<t;i++)n[i]=e[i];return n}function i(e,i){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var n,o,r,l,a=[],s=!0,d=!1;try{if(r=(i=i.call(e)).next,0===t){if(Object(i)!==i)return;s=!1}else for(;!(s=(n=r.call(i)).done)&&(a.push(n.value),a.length!==t);s=!0);}catch(e){d=!0,o=e}finally{try{if(!s&&null!=i.return&&(l=i.return(),Object(l)!==l))return}finally{if(d)throw o}}return a}}(e,i)||function(e,i){if(e){if("string"==typeof e)return t(e,i);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,i):void 0}}(e,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t){var i=function(t,i){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,i||"default");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}(t,"string");return"symbol"==e(i)?i:i+""}var o={align:{center:"gl-items-center",end:"gl-items-end",start:"gl-items-start",stretch:"gl-items-stretch"},direction:{col:"gl-flex-col",row:"gl-flex-row"},flex:{none:"gl-flex-none",grow:"gl-flex-1",shrink:"gl-flex-0"},is_bold:"gl-bold",is_hidden:"gl-hidden",is_italic:"gl-italic",is_uppercase:"gl-uppercase",text:{large:"gl-text-large",normal:"gl-text-normal",small:"gl-text-small"},wrap:{false:"",true:"gl-flex-wrap"}},r="site-reviews-themes",l=function(e,t){var i=_.property(e)(o);return t&&_.isObject(i)?_.property(t)(i)||"":_.isObject(i)?_.values(i).join(" "):i||""},a=function(e,t){return i={},o=GLSR.nameprefix,r=jQuery.extend({_action:e,_nonce:GLSR.nonce[e],formid:jQuery("#form_ID").val(),postid:jQuery("#post_ID").val()},t),(o=n(o))in i?Object.defineProperty(i,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):i[o]=r,i;var i,o,r},s=function(e,t){if(0===e.length)return e;var n=i(t.split("|"),2),o=n[0],r=n[1],l=e;return"chars"===r?l=e.split("").reduce((function(e,t,i){return i<o?e+t:e})):"words"===r&&(l=e.split(" ").reduce((function(e,t,i){return i<o?e+" "+t:e}))),e!==l&&(l=l.replace(/[\W]+$/g,"")),l};function d(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.autoplay,o=void 0!==n&&n,l=i.gap,a=void 0===l?16:l,s=i.maxslides,d=void 0===s?6:s,u=i.minwidth,h=void 0===u?320:u,p=i.navigation,g=void 0!==p&&p,f=i.pagination,m={arrows:g,arrowPath:"M14.447 21.004l7.214 7.057c.24.246.533.363.881.363.708 0 1.277-.559 1.277-1.258 0-.354-.15-.67-.402-.922l-6.414-6.246 6.414-6.24c.254-.254.402-.574.402-.919 0-.702-.569-1.258-1.277-1.258-.351 0-.641.117-.881.357l-7.214 7.06c-.31.3-.444.62-.447 1.003s.135.698.447 1.004z",classes:{arrow:"splide__arrow gl-swiper-arrow",arrows:"splide__arrows gl-swiper-arrows",next:"splide__arrow--next gl-swiper-next",page:"gl-swiper-bullet",pagination:"splide__pagination gl-swiper-pagination",prev:"splide__arrow--prev gl-swiper-prev"},flickMaxPages:1,gap:a,noDrag:"a",autoplay:o,pagination:void 0!==f&&f,perMove:1,perPage:1,snap:!0};o&&(m.type="loop");var v=new Splide(t,m),b=c.bind(v,{maxslides:d,minwidth:h});return v.on("drag",(function(){return v.root.classList.add("is-dragging")})),v.on("dragged",(function(){return v.root.classList.remove("is-dragging")})),v.on("mounted",(function(){1===v.length&&(v.options.drag=!1,v.root.classList.add("no-drag"))})),v.on("resize",b),void 0!==e(GLSR.Event)&&GLSR.Event.on(r+"/swiper/resize",b),v}function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.maxslides,i=void 0===t?6:t,n=e.minwidth,o=void 0===n?320:n;if(this.state.is(Splide.STATES.IDLE)){var r=Math.floor(this.Components.Layout.listSize()/o),l=Math.min(r,i||6);this.options={perPage:l}}}function u(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.maxslides,i=void 0===t?6:t,n=e.minwidth,o=void 0===n?320:n,r={},l=1;l<=i;l++)r[o*l]={slidesPerView:l};return r}var h=function(e){var t=e.split("|");return!(5!==t.length||_.isNaN(+t[0])||_.isNaN(+t[1])||_.isNaN(+t[2])||_.isNaN(+t[3]))&&t},p=function(e){var t=e.split("|");return!(6!==t.length||_.isNaN(+t[0])||_.isNaN(+t[1])||_.isNaN(+t[2])||_.isNaN(+t[3])||!~["%","px","em","rem"].indexOf(t[4])||!~[0,1].indexOf(+t[5]))&&t},g=function(e){var t=e.split("|");return!(7!==t.length||!~[0,1].indexOf(+t[6]))&&t},f=function(e){var t=e.split("|");return!(4!==t.length||_.isNaN(+t[0])||_.isNaN(+t[1])||!~["ch","em","ex","pt","px","rem"].indexOf(t[2]))&&t},m=Backbone.View.extend({attributes:{role:"tab",type:"button"},className:"components-button edit-post-sidebar__panel-tab",group:null,metabox:null,tagName:"button",events:{click:"onClick"},initialize:function(e){_.extend(this,_.pick(e,"group","metabox")),this.listenTo(this.metabox,"toggle:group",this.toggle)},onClick:function(e){e.preventDefault(),e.currentTarget.blur(),this.metabox.trigger("toggle:group",this.group)},render:function(){var e=this.metabox.data[this.group].label;return this.$el.html(e).attr({"aria-label":e,"data-group":this.group}),this},toggle:function(e){if(e===this.group)return this.$el.attr("aria-selected","true"),void this.$el.attr("tabindex",-1);this.$el.attr("aria-selected","false"),this.$el.removeAttr("tabindex")}}),v=Backbone.View.extend({el:null,template:wp.template("glsrt-nav"),metabox:null,preinitialize:function(e){_.extend(this,_.pick(e,"metabox")),this.el=this.metabox.el.querySelector(".edit-post-sidebar")},render:function(){var e=this;this.$el.html(this.template());var t=this.$el.find(".glsr-panel-tabs");return _.each(this.metabox.data,(function(i,n){var o=new m({group:n,metabox:e.metabox});t.append(o.render().el)})),this.metabox.trigger("toggle:group",_.first(_.keys(this.metabox.data))),this}}),b=Backbone.Model.extend({defaults:{after:"",default:"",depends_on:{},group:"",hidden:!0,label:"",name:"",options:{},section:"",tooltip:"",tooltips:[],value:""},hasLinkedValues:!1,initialize:function(){if("boxshadow"===this.get("type"))!1===h(this.get("value"))&&this.set("value",this.get("default"),{silent:!0});else if("checkbox"===this.get("type")){var e=_.intersection(this.get("value"),_.keys(this.get("options")));this.set("value",e,{silent:!0})}else"dimensions"===this.get("type")?(!1===p(this.get("value"))&&this.set("value",this.get("default"),{silent:!0}),this.setHasLinkedValues(this.get("value"))):"excerpt"===this.get("type")?!1===function(e){var t=e.split("|");return!(2!==t.length||_.isNaN(+t[0])||!~["chars","words"].indexOf(t[1]))&&t}(this.get("value"))&&this.set("value",this.get("default"),{silent:!0}):"ratingcolors"===this.get("type")?(!1===g(this.get("value"))&&this.set("value",this.get("default"),{silent:!0}),this.setHasLinkedValues(this.get("value"))):"typography"===this.get("type")&&!1===f(this.get("value"))&&this.set("value",this.get("default"),{silent:!0})},setHasLinkedValues:function(e){_.isArray(e)||(this.hasLinkedValues=!!+_.last(e.split("|")))},validate:function(e){this.setHasLinkedValues(e.value)}}),w=Backbone.Collection.extend({model:b}),y=Backbone.View.extend({className:"glsr-metabox-field",events:{"input input":"onChange",'input input[type="range"]':"onChange","change input":"onChange","change:colorpicker input":"onChange","change select":"onSelect","focus select":"storeSelection","click .glsrt-dimensions > button":"onLink","click .glsrt-ratingcolors > button":"onLink"},isBusy:!1,selected:"",template:wp.template("glsrt-setting"),templates:{boxshadow:wp.template("glsrt-input-boxshadow"),checkbox:wp.template("glsrt-input-checkbox"),color:wp.template("glsrt-input-colorpicker"),dimensions:wp.template("glsrt-input-dimensions"),excerpt:wp.template("glsrt-input-excerpt"),form:wp.template("glsrt-select-form"),number:wp.template("glsrt-input-number"),range:wp.template("glsrt-input-range"),ratingcolors:wp.template("glsrt-input-ratingcolors"),select:wp.template("glsrt-select"),text:wp.template("glsrt-input-text"),typography:wp.template("glsrt-input-typography")},initialize:function(){var e=this;this.listenTo(this.model,"model:hide",(function(){return e.$el.addClass("glsr-hidden")})),this.listenTo(this.model,"model:show",(function(){return e.$el.removeClass("glsr-hidden")})),this.listenTo(this.model,"model:refresh",this.refresh)},onChange:function(e){this.isBusy||this.updateModel(e.currentTarget)},onLink:function(e){this.model.hasLinkedValues=!this.model.hasLinkedValues,this.model.set("value",this.value(e.currentTarget),{validate:!0}),jQuery(e.currentTarget)[this.model.hasLinkedValues?"addClass":"removeClass"]("is-pressed")},onSelect:function(e){this.isBusy||("appearance"!==this.model.get("name")||"custom"!==this.selected||window.confirm(wp.i18n._x("This will remove your custom settings, are you sure you want to continue?.","admin-text","site-reviews-themes"))?this.updateModel(e.currentTarget):jQuery(e.target).val(this.selected))},refresh:function(){this.render()},render:function(){this.$el.html(this.template(this.model.attributes));var e=this.templates[this.model.get("type")];return e?(this.el.dataset.type=this.model.get("type"),this.$el.find(".glsr-input").html(e(this.model.attributes))):console.error(this.model.attributes),this.storeSelection(),this},storeSelection:function(){"appearance"===this.model.get("name")&&(this.selected=this.model.get("value"))},updateLinkedColors:function(e){if(this.model.hasLinkedValues&&"text"===e.type){var t=jQuery(e).closest(".glsrt-ratingcolors"),i=jQuery(e).iris("color");t.find("input[data-linked]").each((function(e,t){return jQuery(t).iris("color",i)}))}},updateLinkedDimensions:function(e){if(this.model.hasLinkedValues&&"number"===e.type){var t=jQuery(e).closest(".glsrt-dimensions"),i=e.value;t.find("[type=number]").each((function(e,t){return t.value=i}))}},updateLinkedRange:function(e){e.previousElementSibling&&"range"===e.previousElementSibling.type&&(e.previousElementSibling.value=e.value),"range"===e.type&&e.nextElementSibling&&"number"===e.nextElementSibling.type&&(e.nextElementSibling.value=e.value)},updateModel:function(e){this.isBusy=!0,this.updateLinkedColors(e),this.updateLinkedDimensions(e),this.updateLinkedRange(e),this.model.set("value",this.value(e),{validate:!0}),this.isBusy=!1},value:function(e){var t=this.model.get("type");if(~["boxshadow","dimensions","excerpt","ratingcolors","typography"].indexOf(t)){var i=jQuery(e).closest(".glsr-metabox-field").find("input[data-linked], select[data-linked]"),n=_.map(i,(function(e){return jQuery(e).hasClass(".glsr-color-picker")?jQuery(e).iris("color"):e.value}));return~["boxshadow","excerpt","typography"].indexOf(t)||n.push(+this.model.hasLinkedValues),n.join("|")}if(~["checkbox"].indexOf(t)){var o=jQuery(e).closest(".glsr-metabox-field").find('input[type="checkbox"]');return _.map(_.filter(o,(function(e){return e.checked})),(function(e){return e.value}))}return e.value}}),x=Backbone.View.extend({className:"components-panel",group:null,opened:!1,panel:null,section:null,tagName:"div",template:wp.template("glsrt-setting-panel"),metabox:null,events:{"click .components-panel__body-toggle":"togglePanel"},initialize:function(e){_.extend(this,_.pick(e,"group","metabox","panel","section")),this.listenTo(this.metabox,"close:panels",this.closePanels),this.listenTo(this.metabox,"toggle:group",this.toggleGroup)},closePanels:function(){this.$el.find(".components-panel__body").removeClass("is-opened"),this.opened=!1},render:function(){var e=this;this.$el.html(this.template({section:this.section,dashicon:this.panel.dashicon,label:this.panel.label,opened:!1})),this.$el.attr("data-group",this.group);var t=this.$el.find(".glsrt-fields");return _.each(this.panel.controls,(function(i,n){var o=e.metabox.collections[e.group].findWhere((function(e){return e.get("name")===n}));if(o){var r=new y({model:o});t.append(r.render().el)}})),this},toggleGroup:function(e){this.metabox.trigger("close:panels"),this.$el[e===this.group?"show":"hide"]()},togglePanel:function(){var e=this.opened;this.metabox.trigger("close:panels"),e||(this.$el.find(".components-panel__body").addClass("is-opened"),this.opened=!0)}}),k=x,T=Backbone.View.extend({el:"#glsrt-settings",metabox:null,initialize:function(e){_.extend(this,_.pick(e,"metabox")),this.listenTo(this.metabox,"document:keydown",this.onBodyKeydown)},onBodyKeydown:function(e){~["Enter"].indexOf(e.key)&&"INPUT"===e.target.tagName&&this.el.contains(e.target)&&e.preventDefault()},render:function(){var e=this;return this.$el.html(""),_.each(this.metabox.data,(function(t,i){_.each(t.data,(function(t,n){var o=new k({group:i,metabox:e.metabox,panel:t,section:n});e.$el.append(o.render().el)}))})),this}}),C=Backbone.View.extend({el:"#glsrt-metabox-settings",data:{},collections:{},addon:null,navigation:null,settings:null,theme:null,initialize:function(e){_.extend(this,_.pick(e,"addon")),this.navigation=new v({metabox:this}),this.settings=new T({metabox:this})},getSettings:function(){var e={};return _.each(this.collections,(function(t,i){e[i]={},t.each((function(t){var n=t.get("name"),o=t.get("value"),r=t.get("section");e[i][r]||(e[i][r]={}),e[i][r][n]=o}))})),e},handleDependencies:function(){var e=this;_.each(this.collections,(function(t,i){t.each((function(t){return e.handleDependency(t)}))}))},handleDependency:function(e){var t=e.get("group")+"."+e.get("section")+"."+e.get("name"),i=e.get("value");_.each(this.collections,(function(e,n){var o=e.filter((function(e){return _.find(e.get("depends_on"),(function(e,i){return i===t}))}));_.each(o,(function(e){var n=e.get("depends_on"),o=_.isArray(n[t])?n[t]:[n[t]];e.trigger(~o.indexOf(i)?"model:show":"model:hide")}))}))},populateCollections:function(){var e=this;_.each(this.data,(function(t,i){e.collections[i]=new w,_.each(t.data,(function(t,n){_.each(t.controls,(function(t){e.collections[i].add(t)}))}))}))},refresh:function(e){e&&this.syncAppearance(e),this.syncData(),this.handleDependencies(),this.theme.trigger("theme:refresh")},render:function(){var e=this;return this.populateCollections(),this.settings.render(),this.navigation.render(),this.refresh(),_.each(this.collections,(function(t){e.listenTo(t,"change",_.debounce(e.refresh,5))})),this},syncAppearance:function(e){var t=this,i=this.collections.presentation.findWhere({name:"appearance"}),n=_.get(this.theme.builder.data.styles,i.get("value"));if("custom"!==i.get("value")){if("appearance"!==e.get("name")){var o=e.get("group"),r=e.get("section"),l=e.get("name"),a=_.get(n,[o,r,l]);a&&a!==e.get(a)&&(i.set("value","custom",{silent:!0}),i.trigger("model:refresh"))}else _.each(n,(function(e,i){_.each(e,(function(e,n){_.each(e,(function(e,o){var r=t.collections[i].findWhere({section:n,name:o});r&&(r.set("value",e,{silent:!0}),r.trigger("model:refresh"))}))}))}));this.settings.metabox.trigger("colorpicker"),this.settings.metabox.trigger("tippy")}},syncData:function(){this.$el.find("[data-settings]").val(JSON.stringify(this.getSettings()))},values:function(){var e={};return _.each(this.collections,(function(t){t.each((function(t){var i=t.get("name");e[i]={default:t.get("default"),theme:t.get("theme"),type:t.get("type"),value:t.get("value")}}))})),e}}),S=C,E=Backbone.View.extend({el:"#glsrt-form",selected:"",metabox:null,events:{"change select":"onChangeForm","focus select":"onFocusForm"},initialize:function(e){_.extend(this,_.pick(e,"metabox")),this.selected=this.$el.find("select").val()},buildShortcodes:function(e){var t=this,i=jQuery("#post_ID").val();jQuery("#shortcodesdiv [data-shortcode]").each((function(e,n){var o=jQuery(n),r=[o.data("shortcode")];r.push('theme="'+i+'"'),1===o.data("form")&&t.selected&&r.push('form="'+i+'"'),o.text("["+r.join(" ")+"]")}))},fetchTags:function(e){var t=this;return this.metabox.tags.$el.hide(),this.metabox.$el.find(".loading-content").show(),wp.ajax.post(GLSR.action,a("theme-tags",{formid:e})).then((function(e){t.metabox.data=e.tags,t.metabox.theme.reviews=e.reviews,t.metabox.tags.render(),t.metabox.theme.trigger("builder:purge",t.metabox.tags.collection),t.metabox.theme.trigger("sortable"),t.metabox.$el.find(".loading-content").hide(),t.metabox.tags.$el.show()}))},onChangeForm:function(e){var t=this,i=jQuery(e.target),n=i.val();window.confirm(wp.i18n._x("Are you sure you want to change the form? This action will remove any fields from the builder which do not exist in the form.","admin-text","site-reviews-themes"))?(i.attr("disabled",!0),this.fetchTags(n).then((function(){t.selected=n,t.buildShortcodes(n),i.removeAttr("disabled")}))):i.val(this.selected)},onFocusForm:function(e){this.selected=jQuery(e.target).val()}});function D(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function M(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?D(Object(i),!0).forEach((function(t){A(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):D(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}function A(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function N(){return N=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},N.apply(this,arguments)}function F(e,t){if(null==e)return{};var i,n,o=function(e,t){if(null==e)return{};var i,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)i=r[n],t.indexOf(i)>=0||(o[i]=e[i]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)i=r[n],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(o[i]=e[i])}return o}function $(e){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(e)}var B=$(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),P=$(/Edge/i),I=$(/firefox/i),j=$(/safari/i)&&!$(/chrome/i)&&!$(/android/i),R=$(/iP(ad|od|hone)/i),L=$(/chrome/i)&&$(/android/i),V={capture:!1,passive:!1};function W(e,t,i){e.addEventListener(t,i,!B&&V)}function X(e,t,i){e.removeEventListener(t,i,!B&&V)}function Y(e,t){if(t){if(">"===t[0]&&(t=t.substring(1)),e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch(e){return!1}return!1}}function z(e){return e.host&&e!==document&&e.host.nodeType?e.host:e.parentNode}function Q(e,t,i,n){if(e){i=i||document;do{if(null!=t&&(">"===t[0]?e.parentNode===i&&Y(e,t):Y(e,t))||n&&e===i)return e;if(e===i)break}while(e=z(e))}return null}var G,H=/\s+/g;function U(e,t,i){if(e&&t)if(e.classList)e.classList[i?"add":"remove"](t);else{var n=(" "+e.className+" ").replace(H," ").replace(" "+t+" "," ");e.className=(n+(i?" "+t:"")).replace(H," ")}}function J(e,t,i){var n=e&&e.style;if(n){if(void 0===i)return document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(i=e.currentStyle),void 0===t?i:i[t];t in n||-1!==t.indexOf("webkit")||(t="-webkit-"+t),n[t]=i+("string"==typeof i?"":"px")}}function K(e,t){var i="";if("string"==typeof e)i=e;else do{var n=J(e,"transform");n&&"none"!==n&&(i=n+" "+i)}while(!t&&(e=e.parentNode));var o=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return o&&new o(i)}function q(e,t,i){if(e){var n=e.getElementsByTagName(t),o=0,r=n.length;if(i)for(;o<r;o++)i(n[o],o);return n}return[]}function Z(){var e=document.scrollingElement;return e||document.documentElement}function ee(e,t,i,n,o){if(e.getBoundingClientRect||e===window){var r,l,a,s,d,c,u;if(e!==window&&e.parentNode&&e!==Z()?(l=(r=e.getBoundingClientRect()).top,a=r.left,s=r.bottom,d=r.right,c=r.height,u=r.width):(l=0,a=0,s=window.innerHeight,d=window.innerWidth,c=window.innerHeight,u=window.innerWidth),(t||i)&&e!==window&&(o=o||e.parentNode,!B))do{if(o&&o.getBoundingClientRect&&("none"!==J(o,"transform")||i&&"static"!==J(o,"position"))){var h=o.getBoundingClientRect();l-=h.top+parseInt(J(o,"border-top-width")),a-=h.left+parseInt(J(o,"border-left-width")),s=l+r.height,d=a+r.width;break}}while(o=o.parentNode);if(n&&e!==window){var p=K(o||e),g=p&&p.a,f=p&&p.d;p&&(s=(l/=f)+(c/=f),d=(a/=g)+(u/=g))}return{top:l,left:a,bottom:s,right:d,width:u,height:c}}}function te(e,t,i){for(var n=le(e,!0),o=ee(e)[t];n;){var r=ee(n)[i];if(!("top"===i||"left"===i?o>=r:o<=r))return n;if(n===Z())break;n=le(n,!1)}return!1}function ie(e,t,i,n){for(var o=0,r=0,l=e.children;r<l.length;){if("none"!==l[r].style.display&&l[r]!==ut.ghost&&(n||l[r]!==ut.dragged)&&Q(l[r],i.draggable,e,!1)){if(o===t)return l[r];o++}r++}return null}function ne(e,t){for(var i=e.lastElementChild;i&&(i===ut.ghost||"none"===J(i,"display")||t&&!Y(i,t));)i=i.previousElementSibling;return i||null}function oe(e,t){var i=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)"TEMPLATE"===e.nodeName.toUpperCase()||e===ut.clone||t&&!Y(e,t)||i++;return i}function re(e){var t=0,i=0,n=Z();if(e)do{var o=K(e),r=o.a,l=o.d;t+=e.scrollLeft*r,i+=e.scrollTop*l}while(e!==n&&(e=e.parentNode));return[t,i]}function le(e,t){if(!e||!e.getBoundingClientRect)return Z();var i=e,n=!1;do{if(i.clientWidth<i.scrollWidth||i.clientHeight<i.scrollHeight){var o=J(i);if(i.clientWidth<i.scrollWidth&&("auto"==o.overflowX||"scroll"==o.overflowX)||i.clientHeight<i.scrollHeight&&("auto"==o.overflowY||"scroll"==o.overflowY)){if(!i.getBoundingClientRect||i===document.body)return Z();if(n||t)return i;n=!0}}}while(i=i.parentNode);return Z()}function ae(e,t){return Math.round(e.top)===Math.round(t.top)&&Math.round(e.left)===Math.round(t.left)&&Math.round(e.height)===Math.round(t.height)&&Math.round(e.width)===Math.round(t.width)}function se(e,t){return function(){if(!G){var i=arguments;1===i.length?e.call(this,i[0]):e.apply(this,i),G=setTimeout((function(){G=void 0}),t)}}}function de(e,t,i){e.scrollLeft+=t,e.scrollTop+=i}function ce(e){var t=window.Polymer,i=window.jQuery||window.Zepto;return t&&t.dom?t.dom(e).cloneNode(!0):i?i(e).clone(!0)[0]:e.cloneNode(!0)}function ue(e,t,i){var n={};return Array.from(e.children).forEach((function(o){var r,l,a,s;if(Q(o,t.draggable,e,!1)&&!o.animated&&o!==i){var d=ee(o);n.left=Math.min(null!==(r=n.left)&&void 0!==r?r:1/0,d.left),n.top=Math.min(null!==(l=n.top)&&void 0!==l?l:1/0,d.top),n.right=Math.max(null!==(a=n.right)&&void 0!==a?a:-1/0,d.right),n.bottom=Math.max(null!==(s=n.bottom)&&void 0!==s?s:-1/0,d.bottom)}})),n.width=n.right-n.left,n.height=n.bottom-n.top,n.x=n.left,n.y=n.top,n}var he="Sortable"+(new Date).getTime();function pe(){var e,t=[];return{captureAnimationState:function(){(t=[],this.options.animation)&&[].slice.call(this.el.children).forEach((function(e){if("none"!==J(e,"display")&&e!==ut.ghost){t.push({target:e,rect:ee(e)});var i=M({},t[t.length-1].rect);if(e.thisAnimationDuration){var n=K(e,!0);n&&(i.top-=n.f,i.left-=n.e)}e.fromRect=i}}))},addAnimationState:function(e){t.push(e)},removeAnimationState:function(e){t.splice(function(e,t){for(var i in e)if(e.hasOwnProperty(i))for(var n in t)if(t.hasOwnProperty(n)&&t[n]===e[i][n])return Number(i);return-1}(t,{target:e}),1)},animateAll:function(i){var n=this;if(!this.options.animation)return clearTimeout(e),void("function"==typeof i&&i());var o=!1,r=0;t.forEach((function(e){var t=0,i=e.target,l=i.fromRect,a=ee(i),s=i.prevFromRect,d=i.prevToRect,c=e.rect,u=K(i,!0);u&&(a.top-=u.f,a.left-=u.e),i.toRect=a,i.thisAnimationDuration&&ae(s,a)&&!ae(l,a)&&(c.top-a.top)/(c.left-a.left)==(l.top-a.top)/(l.left-a.left)&&(t=function(e,t,i,n){return Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))/Math.sqrt(Math.pow(t.top-i.top,2)+Math.pow(t.left-i.left,2))*n.animation}(c,s,d,n.options)),ae(a,l)||(i.prevFromRect=l,i.prevToRect=a,t||(t=n.options.animation),n.animate(i,c,a,t)),t&&(o=!0,r=Math.max(r,t),clearTimeout(i.animationResetTimer),i.animationResetTimer=setTimeout((function(){i.animationTime=0,i.prevFromRect=null,i.fromRect=null,i.prevToRect=null,i.thisAnimationDuration=null}),t),i.thisAnimationDuration=t)})),clearTimeout(e),o?e=setTimeout((function(){"function"==typeof i&&i()}),r):"function"==typeof i&&i(),t=[]},animate:function(e,t,i,n){if(n){J(e,"transition",""),J(e,"transform","");var o=K(this.el),r=o&&o.a,l=o&&o.d,a=(t.left-i.left)/(r||1),s=(t.top-i.top)/(l||1);e.animatingX=!!a,e.animatingY=!!s,J(e,"transform","translate3d("+a+"px,"+s+"px,0)"),this.forRepaintDummy=function(e){return e.offsetWidth}(e),J(e,"transition","transform "+n+"ms"+(this.options.easing?" "+this.options.easing:"")),J(e,"transform","translate3d(0,0,0)"),"number"==typeof e.animated&&clearTimeout(e.animated),e.animated=setTimeout((function(){J(e,"transition",""),J(e,"transform",""),e.animated=!1,e.animatingX=!1,e.animatingY=!1}),n)}}}}var ge=[],fe={initializeByDefault:!0},me={mount:function(e){for(var t in fe)fe.hasOwnProperty(t)&&!(t in e)&&(e[t]=fe[t]);ge.forEach((function(t){if(t.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")})),ge.push(e)},pluginEvent:function(e,t,i){var n=this;this.eventCanceled=!1,i.cancel=function(){n.eventCanceled=!0};var o=e+"Global";ge.forEach((function(n){t[n.pluginName]&&(t[n.pluginName][o]&&t[n.pluginName][o](M({sortable:t},i)),t.options[n.pluginName]&&t[n.pluginName][e]&&t[n.pluginName][e](M({sortable:t},i)))}))},initializePlugins:function(e,t,i,n){for(var o in ge.forEach((function(n){var o=n.pluginName;if(e.options[o]||n.initializeByDefault){var r=new n(e,t,e.options);r.sortable=e,r.options=e.options,e[o]=r,N(i,r.defaults)}})),e.options)if(e.options.hasOwnProperty(o)){var r=this.modifyOption(e,o,e.options[o]);void 0!==r&&(e.options[o]=r)}},getEventProperties:function(e,t){var i={};return ge.forEach((function(n){"function"==typeof n.eventProperties&&N(i,n.eventProperties.call(t[n.pluginName],e))})),i},modifyOption:function(e,t,i){var n;return ge.forEach((function(o){e[o.pluginName]&&o.optionListeners&&"function"==typeof o.optionListeners[t]&&(n=o.optionListeners[t].call(e[o.pluginName],i))})),n}};function ve(e){var t=e.sortable,i=e.rootEl,n=e.name,o=e.targetEl,r=e.cloneEl,l=e.toEl,a=e.fromEl,s=e.oldIndex,d=e.newIndex,c=e.oldDraggableIndex,u=e.newDraggableIndex,h=e.originalEvent,p=e.putSortable,g=e.extraEventProperties;if(t=t||i&&i[he]){var f,m=t.options,v="on"+n.charAt(0).toUpperCase()+n.substr(1);!window.CustomEvent||B||P?(f=document.createEvent("Event")).initEvent(n,!0,!0):f=new CustomEvent(n,{bubbles:!0,cancelable:!0}),f.to=l||i,f.from=a||i,f.item=o||i,f.clone=r,f.oldIndex=s,f.newIndex=d,f.oldDraggableIndex=c,f.newDraggableIndex=u,f.originalEvent=h,f.pullMode=p?p.lastPutMode:void 0;var b=M(M({},g),me.getEventProperties(n,t));for(var w in b)f[w]=b[w];i&&i.dispatchEvent(f),m[v]&&m[v].call(t,f)}}var be=["evt"],we=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i.evt,o=F(i,be);me.pluginEvent.bind(ut)(e,t,M({dragEl:xe,parentEl:_e,ghostEl:ke,rootEl:Te,nextEl:Ce,lastDownEl:Se,cloneEl:Ee,cloneHidden:De,dragStarted:Ve,putSortable:$e,activeSortable:ut.active,originalEvent:n,oldIndex:Me,oldDraggableIndex:Ae,newIndex:Oe,newDraggableIndex:Ne,hideGhostForTarget:at,unhideGhostForTarget:st,cloneNowHidden:function(){De=!0},cloneNowShown:function(){De=!1},dispatchSortableEvent:function(e){ye({sortable:t,name:e,originalEvent:n})}},o))};function ye(e){ve(M({putSortable:$e,cloneEl:Ee,targetEl:xe,rootEl:Te,oldIndex:Me,oldDraggableIndex:Ae,newIndex:Oe,newDraggableIndex:Ne},e))}var xe,_e,ke,Te,Ce,Se,Ee,De,Me,Oe,Ae,Ne,Fe,$e,Be,Pe,Ie,je,Re,Le,Ve,We,Xe,Ye,ze,Qe=!1,Ge=!1,He=[],Ue=!1,Je=!1,Ke=[],qe=!1,Ze=[],et="undefined"!=typeof document,tt=R,it=P||B?"cssFloat":"float",nt=et&&!L&&!R&&"draggable"in document.createElement("div"),ot=function(){if(et){if(B)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto","auto"===e.style.pointerEvents}}(),rt=function(e,t){var i=J(e),n=parseInt(i.width)-parseInt(i.paddingLeft)-parseInt(i.paddingRight)-parseInt(i.borderLeftWidth)-parseInt(i.borderRightWidth),o=ie(e,0,t),r=ie(e,1,t),l=o&&J(o),a=r&&J(r),s=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+ee(o).width,d=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+ee(r).width;if("flex"===i.display)return"column"===i.flexDirection||"column-reverse"===i.flexDirection?"vertical":"horizontal";if("grid"===i.display)return i.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(o&&l.float&&"none"!==l.float){var c="left"===l.float?"left":"right";return!r||"both"!==a.clear&&a.clear!==c?"horizontal":"vertical"}return o&&("block"===l.display||"flex"===l.display||"table"===l.display||"grid"===l.display||s>=n&&"none"===i[it]||r&&"none"===i[it]&&s+d>n)?"vertical":"horizontal"},lt=function(e){function t(e,i){return function(n,o,r,l){var a=n.options.group.name&&o.options.group.name&&n.options.group.name===o.options.group.name;if(null==e&&(i||a))return!0;if(null==e||!1===e)return!1;if(i&&"clone"===e)return e;if("function"==typeof e)return t(e(n,o,r,l),i)(n,o,r,l);var s=(i?n:o).options.group.name;return!0===e||"string"==typeof e&&e===s||e.join&&e.indexOf(s)>-1}}var i={},n=e.group;n&&"object"==O(n)||(n={name:n}),i.name=n.name,i.checkPull=t(n.pull,!0),i.checkPut=t(n.put),i.revertClone=n.revertClone,e.group=i},at=function(){!ot&&ke&&J(ke,"display","none")},st=function(){!ot&&ke&&J(ke,"display","")};et&&!L&&document.addEventListener("click",(function(e){if(Ge)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),Ge=!1,!1}),!0);var dt=function(e){if(xe){e=e.touches?e.touches[0]:e;var t=(o=e.clientX,r=e.clientY,He.some((function(e){var t=e[he].options.emptyInsertThreshold;if(t&&!ne(e)){var i=ee(e),n=o>=i.left-t&&o<=i.right+t,a=r>=i.top-t&&r<=i.bottom+t;return n&&a?l=e:void 0}})),l);if(t){var i={};for(var n in e)e.hasOwnProperty(n)&&(i[n]=e[n]);i.target=i.rootEl=t,i.preventDefault=void 0,i.stopPropagation=void 0,t[he]._onDragOver(i)}}var o,r,l},ct=function(e){xe&&xe.parentNode[he]._isOutsideThisEl(e.target)};function ut(e,t){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=t=N({},t),e[he]=this;var i={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return rt(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==ut.supportPointer&&"PointerEvent"in window&&!j,emptyInsertThreshold:5};for(var n in me.initializePlugins(this,e,i),i)!(n in t)&&(t[n]=i[n]);for(var o in lt(t),this)"_"===o.charAt(0)&&"function"==typeof this[o]&&(this[o]=this[o].bind(this));this.nativeDraggable=!t.forceFallback&&nt,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?W(e,"pointerdown",this._onTapStart):(W(e,"mousedown",this._onTapStart),W(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(W(e,"dragover",this),W(e,"dragenter",this)),He.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),N(this,pe())}function ht(e,t,i,n,o,r,l,a){var s,d,c=e[he],u=c.options.onMove;return!window.CustomEvent||B||P?(s=document.createEvent("Event")).initEvent("move",!0,!0):s=new CustomEvent("move",{bubbles:!0,cancelable:!0}),s.to=t,s.from=e,s.dragged=i,s.draggedRect=n,s.related=o||t,s.relatedRect=r||ee(t),s.willInsertAfter=a,s.originalEvent=l,e.dispatchEvent(s),u&&(d=u.call(c,s,l)),d}function pt(e){e.draggable=!1}function gt(){qe=!1}function ft(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,i=t.length,n=0;i--;)n+=t.charCodeAt(i);return n.toString(36)}function mt(e){return setTimeout(e,0)}function vt(e){return clearTimeout(e)}ut.prototype={constructor:ut,_isOutsideThisEl:function(e){this.el.contains(e)||e===this.el||(We=null)},_getDirection:function(e,t){return"function"==typeof this.options.direction?this.options.direction.call(this,e,t,xe):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,i=this.el,n=this.options,o=n.preventOnFilter,r=e.type,l=e.touches&&e.touches[0]||e.pointerType&&"touch"===e.pointerType&&e,a=(l||e).target,s=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||a,d=n.filter;if(function(e){Ze.length=0;var t=e.getElementsByTagName("input"),i=t.length;for(;i--;){var n=t[i];n.checked&&Ze.push(n)}}(i),!xe&&!(/mousedown|pointerdown/.test(r)&&0!==e.button||n.disabled)&&!s.isContentEditable&&(this.nativeDraggable||!j||!a||"SELECT"!==a.tagName.toUpperCase())&&!((a=Q(a,n.draggable,i,!1))&&a.animated||Se===a)){if(Me=oe(a),Ae=oe(a,n.draggable),"function"==typeof d){if(d.call(this,e,a,this))return ye({sortable:t,rootEl:s,name:"filter",targetEl:a,toEl:i,fromEl:i}),we("filter",t,{evt:e}),void(o&&e.cancelable&&e.preventDefault())}else if(d&&(d=d.split(",").some((function(n){if(n=Q(s,n.trim(),i,!1))return ye({sortable:t,rootEl:n,name:"filter",targetEl:a,fromEl:i,toEl:i}),we("filter",t,{evt:e}),!0}))))return void(o&&e.cancelable&&e.preventDefault());n.handle&&!Q(s,n.handle,i,!1)||this._prepareDragStart(e,l,a)}}},_prepareDragStart:function(e,t,i){var n,o=this,r=o.el,l=o.options,a=r.ownerDocument;if(i&&!xe&&i.parentNode===r){var s=ee(i);if(Te=r,_e=(xe=i).parentNode,Ce=xe.nextSibling,Se=i,Fe=l.group,ut.dragged=xe,Be={target:xe,clientX:(t||e).clientX,clientY:(t||e).clientY},Re=Be.clientX-s.left,Le=Be.clientY-s.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,xe.style["will-change"]="all",n=function(){we("delayEnded",o,{evt:e}),ut.eventCanceled?o._onDrop():(o._disableDelayedDragEvents(),!I&&o.nativeDraggable&&(xe.draggable=!0),o._triggerDragStart(e,t),ye({sortable:o,name:"choose",originalEvent:e}),U(xe,l.chosenClass,!0))},l.ignore.split(",").forEach((function(e){q(xe,e.trim(),pt)})),W(a,"dragover",dt),W(a,"mousemove",dt),W(a,"touchmove",dt),W(a,"mouseup",o._onDrop),W(a,"touchend",o._onDrop),W(a,"touchcancel",o._onDrop),I&&this.nativeDraggable&&(this.options.touchStartThreshold=4,xe.draggable=!0),we("delayStart",this,{evt:e}),!l.delay||l.delayOnTouchOnly&&!t||this.nativeDraggable&&(P||B))n();else{if(ut.eventCanceled)return void this._onDrop();W(a,"mouseup",o._disableDelayedDrag),W(a,"touchend",o._disableDelayedDrag),W(a,"touchcancel",o._disableDelayedDrag),W(a,"mousemove",o._delayedDragTouchMoveHandler),W(a,"touchmove",o._delayedDragTouchMoveHandler),l.supportPointer&&W(a,"pointermove",o._delayedDragTouchMoveHandler),o._dragStartTimer=setTimeout(n,l.delay)}}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){xe&&pt(xe),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;X(e,"mouseup",this._disableDelayedDrag),X(e,"touchend",this._disableDelayedDrag),X(e,"touchcancel",this._disableDelayedDrag),X(e,"mousemove",this._delayedDragTouchMoveHandler),X(e,"touchmove",this._delayedDragTouchMoveHandler),X(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||"touch"==e.pointerType&&e,!this.nativeDraggable||t?this.options.supportPointer?W(document,"pointermove",this._onTouchMove):W(document,t?"touchmove":"mousemove",this._onTouchMove):(W(xe,"dragend",this),W(Te,"dragstart",this._onDragStart));try{document.selection?mt((function(){document.selection.empty()})):window.getSelection().removeAllRanges()}catch(e){}},_dragStarted:function(e,t){if(Qe=!1,Te&&xe){we("dragStarted",this,{evt:t}),this.nativeDraggable&&W(document,"dragover",ct);var i=this.options;!e&&U(xe,i.dragClass,!1),U(xe,i.ghostClass,!0),ut.active=this,e&&this._appendGhost(),ye({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(Pe){this._lastX=Pe.clientX,this._lastY=Pe.clientY,at();for(var e=document.elementFromPoint(Pe.clientX,Pe.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(Pe.clientX,Pe.clientY))!==t;)t=e;if(xe.parentNode[he]._isOutsideThisEl(e),t)do{if(t[he]){if(t[he]._onDragOver({clientX:Pe.clientX,clientY:Pe.clientY,target:e,rootEl:t})&&!this.options.dragoverBubble)break}e=t}while(t=z(t));st()}},_onTouchMove:function(e){if(Be){var t=this.options,i=t.fallbackTolerance,n=t.fallbackOffset,o=e.touches?e.touches[0]:e,r=ke&&K(ke,!0),l=ke&&r&&r.a,a=ke&&r&&r.d,s=tt&&ze&&re(ze),d=(o.clientX-Be.clientX+n.x)/(l||1)+(s?s[0]-Ke[0]:0)/(l||1),c=(o.clientY-Be.clientY+n.y)/(a||1)+(s?s[1]-Ke[1]:0)/(a||1);if(!ut.active&&!Qe){if(i&&Math.max(Math.abs(o.clientX-this._lastX),Math.abs(o.clientY-this._lastY))<i)return;this._onDragStart(e,!0)}if(ke){r?(r.e+=d-(Ie||0),r.f+=c-(je||0)):r={a:1,b:0,c:0,d:1,e:d,f:c};var u="matrix(".concat(r.a,",").concat(r.b,",").concat(r.c,",").concat(r.d,",").concat(r.e,",").concat(r.f,")");J(ke,"webkitTransform",u),J(ke,"mozTransform",u),J(ke,"msTransform",u),J(ke,"transform",u),Ie=d,je=c,Pe=o}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!ke){var e=this.options.fallbackOnBody?document.body:Te,t=ee(xe,!0,tt,!0,e),i=this.options;if(tt){for(ze=e;"static"===J(ze,"position")&&"none"===J(ze,"transform")&&ze!==document;)ze=ze.parentNode;ze!==document.body&&ze!==document.documentElement?(ze===document&&(ze=Z()),t.top+=ze.scrollTop,t.left+=ze.scrollLeft):ze=Z(),Ke=re(ze)}U(ke=xe.cloneNode(!0),i.ghostClass,!1),U(ke,i.fallbackClass,!0),U(ke,i.dragClass,!0),J(ke,"transition",""),J(ke,"transform",""),J(ke,"box-sizing","border-box"),J(ke,"margin",0),J(ke,"top",t.top),J(ke,"left",t.left),J(ke,"width",t.width),J(ke,"height",t.height),J(ke,"opacity","0.8"),J(ke,"position",tt?"absolute":"fixed"),J(ke,"zIndex","100000"),J(ke,"pointerEvents","none"),ut.ghost=ke,e.appendChild(ke),J(ke,"transform-origin",Re/parseInt(ke.style.width)*100+"% "+Le/parseInt(ke.style.height)*100+"%")}},_onDragStart:function(e,t){var i=this,n=e.dataTransfer,o=i.options;we("dragStart",this,{evt:e}),ut.eventCanceled?this._onDrop():(we("setupClone",this),ut.eventCanceled||((Ee=ce(xe)).removeAttribute("id"),Ee.draggable=!1,Ee.style["will-change"]="",this._hideClone(),U(Ee,this.options.chosenClass,!1),ut.clone=Ee),i.cloneId=mt((function(){we("clone",i),ut.eventCanceled||(i.options.removeCloneOnHide||Te.insertBefore(Ee,xe),i._hideClone(),ye({sortable:i,name:"clone"}))})),!t&&U(xe,o.dragClass,!0),t?(Ge=!0,i._loopId=setInterval(i._emulateDragOver,50)):(X(document,"mouseup",i._onDrop),X(document,"touchend",i._onDrop),X(document,"touchcancel",i._onDrop),n&&(n.effectAllowed="move",o.setData&&o.setData.call(i,n,xe)),W(document,"drop",i),J(xe,"transform","translateZ(0)")),Qe=!0,i._dragStartId=mt(i._dragStarted.bind(i,t,e)),W(document,"selectstart",i),Ve=!0,j&&J(document.body,"user-select","none"))},_onDragOver:function(e){var t,i,n,o,r=this.el,l=e.target,a=this.options,s=a.group,d=ut.active,c=Fe===s,u=a.sort,h=$e||d,p=this,g=!1;if(!qe){if(void 0!==e.preventDefault&&e.cancelable&&e.preventDefault(),l=Q(l,a.draggable,r,!0),O("dragOver"),ut.eventCanceled)return g;if(xe.contains(e.target)||l.animated&&l.animatingX&&l.animatingY||p._ignoreWhileAnimating===l)return N(!1);if(Ge=!1,d&&!a.disabled&&(c?u||(n=_e!==Te):$e===this||(this.lastPutMode=Fe.checkPull(this,d,xe,e))&&s.checkPut(this,d,xe,e))){if(o="vertical"===this._getDirection(e,l),t=ee(xe),O("dragOverValid"),ut.eventCanceled)return g;if(n)return _e=Te,A(),this._hideClone(),O("revert"),ut.eventCanceled||(Ce?Te.insertBefore(xe,Ce):Te.appendChild(xe)),N(!0);var f=ne(r,a.draggable);if(!f||function(e,t,i){var n=ee(ne(i.el,i.options.draggable)),o=ue(i.el,i.options,ke),r=10;return t?e.clientX>o.right+r||e.clientY>n.bottom&&e.clientX>n.left:e.clientY>o.bottom+r||e.clientX>n.right&&e.clientY>n.top}(e,o,this)&&!f.animated){if(f===xe)return N(!1);if(f&&r===e.target&&(l=f),l&&(i=ee(l)),!1!==ht(Te,r,xe,t,l,i,e,!!l))return A(),f&&f.nextSibling?r.insertBefore(xe,f.nextSibling):r.appendChild(xe),_e=r,F(),N(!0)}else if(f&&function(e,t,i){var n=ee(ie(i.el,0,i.options,!0)),o=ue(i.el,i.options,ke),r=10;return t?e.clientX<o.left-r||e.clientY<n.top&&e.clientX<n.right:e.clientY<o.top-r||e.clientY<n.bottom&&e.clientX<n.left}(e,o,this)){var m=ie(r,0,a,!0);if(m===xe)return N(!1);if(i=ee(l=m),!1!==ht(Te,r,xe,t,l,i,e,!1))return A(),r.insertBefore(xe,m),_e=r,F(),N(!0)}else if(l.parentNode===r){i=ee(l);var v,b,w,y=xe.parentNode!==r,x=!function(e,t,i){var n=i?e.left:e.top,o=i?e.right:e.bottom,r=i?e.width:e.height,l=i?t.left:t.top,a=i?t.right:t.bottom,s=i?t.width:t.height;return n===l||o===a||n+r/2===l+s/2}(xe.animated&&xe.toRect||t,l.animated&&l.toRect||i,o),_=o?"top":"left",k=te(l,"top","top")||te(xe,"top","top"),T=k?k.scrollTop:void 0;if(We!==l&&(b=i[_],Ue=!1,Je=!x&&a.invertSwap||y),v=function(e,t,i,n,o,r,l,a){var s=n?e.clientY:e.clientX,d=n?i.height:i.width,c=n?i.top:i.left,u=n?i.bottom:i.right,h=!1;if(!l)if(a&&Ye<d*o){if(!Ue&&(1===Xe?s>c+d*r/2:s<u-d*r/2)&&(Ue=!0),Ue)h=!0;else if(1===Xe?s<c+Ye:s>u-Ye)return-Xe}else if(s>c+d*(1-o)/2&&s<u-d*(1-o)/2)return function(e){return oe(xe)<oe(e)?1:-1}(t);if((h=h||l)&&(s<c+d*r/2||s>u-d*r/2))return s>c+d/2?1:-1;return 0}(e,l,i,o,x?1:a.swapThreshold,null==a.invertedSwapThreshold?a.swapThreshold:a.invertedSwapThreshold,Je,We===l),0!==v){var C=oe(xe);do{C-=v,w=_e.children[C]}while(w&&("none"===J(w,"display")||w===ke))}if(0===v||w===l)return N(!1);We=l,Xe=v;var S=l.nextElementSibling,E=!1,D=ht(Te,r,xe,t,l,i,e,E=1===v);if(!1!==D)return 1!==D&&-1!==D||(E=1===D),qe=!0,setTimeout(gt,30),A(),E&&!S?r.appendChild(xe):l.parentNode.insertBefore(xe,E?S:l),k&&de(k,0,T-k.scrollTop),_e=xe.parentNode,void 0===b||Je||(Ye=Math.abs(b-ee(l)[_])),F(),N(!0)}if(r.contains(xe))return N(!1)}return!1}function O(a,s){we(a,p,M({evt:e,isOwner:c,axis:o?"vertical":"horizontal",revert:n,dragRect:t,targetRect:i,canSort:u,fromSortable:h,target:l,completed:N,onMove:function(i,n){return ht(Te,r,xe,t,i,ee(i),e,n)},changed:F},s))}function A(){O("dragOverAnimationCapture"),p.captureAnimationState(),p!==h&&h.captureAnimationState()}function N(t){return O("dragOverCompleted",{insertion:t}),t&&(c?d._hideClone():d._showClone(p),p!==h&&(U(xe,$e?$e.options.ghostClass:d.options.ghostClass,!1),U(xe,a.ghostClass,!0)),$e!==p&&p!==ut.active?$e=p:p===ut.active&&$e&&($e=null),h===p&&(p._ignoreWhileAnimating=l),p.animateAll((function(){O("dragOverAnimationComplete"),p._ignoreWhileAnimating=null})),p!==h&&(h.animateAll(),h._ignoreWhileAnimating=null)),(l===xe&&!xe.animated||l===r&&!l.animated)&&(We=null),a.dragoverBubble||e.rootEl||l===document||(xe.parentNode[he]._isOutsideThisEl(e.target),!t&&dt(e)),!a.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),g=!0}function F(){Oe=oe(xe),Ne=oe(xe,a.draggable),ye({sortable:p,name:"change",toEl:r,newIndex:Oe,newDraggableIndex:Ne,originalEvent:e})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){X(document,"mousemove",this._onTouchMove),X(document,"touchmove",this._onTouchMove),X(document,"pointermove",this._onTouchMove),X(document,"dragover",dt),X(document,"mousemove",dt),X(document,"touchmove",dt)},_offUpEvents:function(){var e=this.el.ownerDocument;X(e,"mouseup",this._onDrop),X(e,"touchend",this._onDrop),X(e,"pointerup",this._onDrop),X(e,"touchcancel",this._onDrop),X(document,"selectstart",this)},_onDrop:function(e){var t=this.el,i=this.options;Oe=oe(xe),Ne=oe(xe,i.draggable),we("drop",this,{evt:e}),_e=xe&&xe.parentNode,Oe=oe(xe),Ne=oe(xe,i.draggable),ut.eventCanceled||(Qe=!1,Je=!1,Ue=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),vt(this.cloneId),vt(this._dragStartId),this.nativeDraggable&&(X(document,"drop",this),X(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),j&&J(document.body,"user-select",""),J(xe,"transform",""),e&&(Ve&&(e.cancelable&&e.preventDefault(),!i.dropBubble&&e.stopPropagation()),ke&&ke.parentNode&&ke.parentNode.removeChild(ke),(Te===_e||$e&&"clone"!==$e.lastPutMode)&&Ee&&Ee.parentNode&&Ee.parentNode.removeChild(Ee),xe&&(this.nativeDraggable&&X(xe,"dragend",this),pt(xe),xe.style["will-change"]="",Ve&&!Qe&&U(xe,$e?$e.options.ghostClass:this.options.ghostClass,!1),U(xe,this.options.chosenClass,!1),ye({sortable:this,name:"unchoose",toEl:_e,newIndex:null,newDraggableIndex:null,originalEvent:e}),Te!==_e?(Oe>=0&&(ye({rootEl:_e,name:"add",toEl:_e,fromEl:Te,originalEvent:e}),ye({sortable:this,name:"remove",toEl:_e,originalEvent:e}),ye({rootEl:_e,name:"sort",toEl:_e,fromEl:Te,originalEvent:e}),ye({sortable:this,name:"sort",toEl:_e,originalEvent:e})),$e&&$e.save()):Oe!==Me&&Oe>=0&&(ye({sortable:this,name:"update",toEl:_e,originalEvent:e}),ye({sortable:this,name:"sort",toEl:_e,originalEvent:e})),ut.active&&(null!=Oe&&-1!==Oe||(Oe=Me,Ne=Ae),ye({sortable:this,name:"end",toEl:_e,originalEvent:e}),this.save())))),this._nulling()},_nulling:function(){we("nulling",this),Te=xe=_e=ke=Ce=Ee=Se=De=Be=Pe=Ve=Oe=Ne=Me=Ae=We=Xe=$e=Fe=ut.dragged=ut.ghost=ut.clone=ut.active=null,Ze.forEach((function(e){e.checked=!0})),Ze.length=Ie=je=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":xe&&(this._onDragOver(e),function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move");e.cancelable&&e.preventDefault()}(e));break;case"selectstart":e.preventDefault()}},toArray:function(){for(var e,t=[],i=this.el.children,n=0,o=i.length,r=this.options;n<o;n++)Q(e=i[n],r.draggable,this.el,!1)&&t.push(e.getAttribute(r.dataIdAttr)||ft(e));return t},sort:function(e,t){var i={},n=this.el;this.toArray().forEach((function(e,t){var o=n.children[t];Q(o,this.options.draggable,n,!1)&&(i[e]=o)}),this),t&&this.captureAnimationState(),e.forEach((function(e){i[e]&&(n.removeChild(i[e]),n.appendChild(i[e]))})),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return Q(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var i=this.options;if(void 0===t)return i[e];var n=me.modifyOption(this,e,t);i[e]=void 0!==n?n:t,"group"===e&&lt(i)},destroy:function(){we("destroy",this);var e=this.el;e[he]=null,X(e,"mousedown",this._onTapStart),X(e,"touchstart",this._onTapStart),X(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(X(e,"dragover",this),X(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),(function(e){e.removeAttribute("draggable")})),this._onDrop(),this._disableDelayedDragEvents(),He.splice(He.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!De){if(we("hideClone",this),ut.eventCanceled)return;J(Ee,"display","none"),this.options.removeCloneOnHide&&Ee.parentNode&&Ee.parentNode.removeChild(Ee),De=!0}},_showClone:function(e){if("clone"===e.lastPutMode){if(De){if(we("showClone",this),ut.eventCanceled)return;xe.parentNode!=Te||this.options.group.revertClone?Ce?Te.insertBefore(Ee,Ce):Te.appendChild(Ee):Te.insertBefore(Ee,xe),this.options.group.revertClone&&this.animate(xe,Ee),J(Ee,"display",""),De=!1}}else this._hideClone()}},et&&W(document,"touchmove",(function(e){(ut.active||Qe)&&e.cancelable&&e.preventDefault()})),ut.utils={on:W,off:X,css:J,find:q,is:function(e,t){return!!Q(e,t,e,!1)},extend:function(e,t){if(e&&t)for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},throttle:se,closest:Q,toggleClass:U,clone:ce,index:oe,nextTick:mt,cancelNextTick:vt,detectDirection:rt,getChild:ie,expando:he},ut.get=function(e){return e[he]},ut.mount=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t[0].constructor===Array&&(t=t[0]),t.forEach((function(e){if(!e.prototype||!e.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(e));e.utils&&(ut.utils=M(M({},ut.utils),e.utils)),me.mount(e)}))},ut.create=function(e,t){return new ut(e,t)},ut.version="1.15.3";var bt,wt,yt,xt,_t,kt,Tt=[],Ct=!1;function St(){Tt.forEach((function(e){clearInterval(e.pid)})),Tt=[]}function Et(){clearInterval(kt)}var Dt=se((function(e,t,i,n){if(t.scroll){var o,r=(e.touches?e.touches[0]:e).clientX,l=(e.touches?e.touches[0]:e).clientY,a=t.scrollSensitivity,s=t.scrollSpeed,d=Z(),c=!1;wt!==i&&(wt=i,St(),bt=t.scroll,o=t.scrollFn,!0===bt&&(bt=le(i,!0)));var u=0,h=bt;do{var p=h,g=ee(p),f=g.top,m=g.bottom,v=g.left,b=g.right,w=g.width,y=g.height,x=void 0,_=void 0,k=p.scrollWidth,T=p.scrollHeight,C=J(p),S=p.scrollLeft,E=p.scrollTop;p===d?(x=w<k&&("auto"===C.overflowX||"scroll"===C.overflowX||"visible"===C.overflowX),_=y<T&&("auto"===C.overflowY||"scroll"===C.overflowY||"visible"===C.overflowY)):(x=w<k&&("auto"===C.overflowX||"scroll"===C.overflowX),_=y<T&&("auto"===C.overflowY||"scroll"===C.overflowY));var D=x&&(Math.abs(b-r)<=a&&S+w<k)-(Math.abs(v-r)<=a&&!!S),M=_&&(Math.abs(m-l)<=a&&E+y<T)-(Math.abs(f-l)<=a&&!!E);if(!Tt[u])for(var O=0;O<=u;O++)Tt[O]||(Tt[O]={});Tt[u].vx==D&&Tt[u].vy==M&&Tt[u].el===p||(Tt[u].el=p,Tt[u].vx=D,Tt[u].vy=M,clearInterval(Tt[u].pid),0==D&&0==M||(c=!0,Tt[u].pid=setInterval(function(){n&&0===this.layer&&ut.active._onTouchMove(_t);var t=Tt[this.layer].vy?Tt[this.layer].vy*s:0,i=Tt[this.layer].vx?Tt[this.layer].vx*s:0;"function"==typeof o&&"continue"!==o.call(ut.dragged.parentNode[he],i,t,e,_t,Tt[this.layer].el)||de(Tt[this.layer].el,i,t)}.bind({layer:u}),24))),u++}while(t.bubbleScroll&&h!==d&&(h=le(h,!1)));Ct=c}}),30),Mt=function(e){var t=e.originalEvent,i=e.putSortable,n=e.dragEl,o=e.activeSortable,r=e.dispatchSortableEvent,l=e.hideGhostForTarget,a=e.unhideGhostForTarget;if(t){var s=i||o;l();var d=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,c=document.elementFromPoint(d.clientX,d.clientY);a(),s&&!s.el.contains(c)&&(r("spill"),this.onSpill({dragEl:n,putSortable:i}))}};function Ot(){}function At(){}Ot.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,i=e.putSortable;this.sortable.captureAnimationState(),i&&i.captureAnimationState();var n=ie(this.sortable.el,this.startIndex,this.options);n?this.sortable.el.insertBefore(t,n):this.sortable.el.appendChild(t),this.sortable.animateAll(),i&&i.animateAll()},drop:Mt},N(Ot,{pluginName:"revertOnSpill"}),At.prototype={onSpill:function(e){var t=e.dragEl,i=e.putSortable||this.sortable;i.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),i.animateAll()},drop:Mt},N(At,{pluginName:"removeOnSpill"});ut.mount(new function(){function e(){for(var e in this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===e.charAt(0)&&"function"==typeof this[e]&&(this[e]=this[e].bind(this))}return e.prototype={dragStarted:function(e){var t=e.originalEvent;this.sortable.nativeDraggable?W(document,"dragover",this._handleAutoScroll):this.options.supportPointer?W(document,"pointermove",this._handleFallbackAutoScroll):t.touches?W(document,"touchmove",this._handleFallbackAutoScroll):W(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(e){var t=e.originalEvent;this.options.dragOverBubble||t.rootEl||this._handleAutoScroll(t)},drop:function(){this.sortable.nativeDraggable?X(document,"dragover",this._handleAutoScroll):(X(document,"pointermove",this._handleFallbackAutoScroll),X(document,"touchmove",this._handleFallbackAutoScroll),X(document,"mousemove",this._handleFallbackAutoScroll)),Et(),St(),clearTimeout(G),G=void 0},nulling:function(){_t=wt=bt=Ct=kt=yt=xt=null,Tt.length=0},_handleFallbackAutoScroll:function(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function(e,t){var i=this,n=(e.touches?e.touches[0]:e).clientX,o=(e.touches?e.touches[0]:e).clientY,r=document.elementFromPoint(n,o);if(_t=e,t||this.options.forceAutoScrollFallback||P||B||j){Dt(e,this.options,r,t);var l=le(r,!0);!Ct||kt&&n===yt&&o===xt||(kt&&Et(),kt=setInterval((function(){var r=le(document.elementFromPoint(n,o),!0);r!==l&&(l=r,St()),Dt(e,i.options,r,t)}),10),yt=n,xt=o)}else{if(!this.options.bubbleScroll||le(r,!0)===Z())return void St();Dt(e,this.options,le(r,!1),!1)}}},N(e,{pluginName:"scroll",initializeByDefault:!0})}),ut.mount(At,Ot);var Nt=Backbone.View.extend({builder:null,model:null,review:null,template:wp.template("glsrt-field"),initialize:function(e){_.extend(this,_.pick(e,"builder","review")),this.model.view=this},render:function(){return this.setAppearance(),this.renderTag(),this},renderTag:function(){var e=this.builder.metabox.addon.tags.tags.collection.findWhere({tag:this.model.get("tag")}),t=_.get(this.review,this.model.get("tag")),i=t;if(e){if("textarea"===e.get("type")&&!_.isEmpty(t)){t=jQuery(t).html(),i=jQuery(i).html();var n=this.builder.metabox.settings.collections.presentation.findWhere({name:"excerpt_action"}),o=this.builder.metabox.settings.collections.presentation.findWhere({name:"excerpt_length"});"disabled"!==n.get("value")&&(t=s(i,o.get("value")))}this.$el.html(this.template(_.extend(e.toJSON(),{text:t,value:i})))}return this.model.isField()&&_.isEmpty(i)&&this.$el.css("display","none"),this},setAppearance:function(){var e=this;return this.$el.addClass(this.model.isField()?"field":"container"),this.model.get("align")&&this.$el.addClass(l("align",this.model.get("align"))),this.model.get("direction")&&this.$el.addClass("gl-flex gl-flex-"+this.model.get("direction")),this.model.get("flex")&&this.$el.addClass(l("flex",this.model.get("flex"))),this.model.get("gap")&&this.$el.css({gap:this.model.get("gap")+"px"}),this.model.get("minwidth")&&this.$el.css({minWidth:this.model.get("minwidth")+"px"}),this.model.get("text")&&this.$el.addClass(l("text",this.model.get("text"))),this.model.get("wrap")&&this.$el.addClass(l("wrap",this.model.get("wrap"))),_.each(["is_bold","is_hidden","is_italic","is_uppercase"],(function(t){e.model.get(t)&&e.$el.addClass(l(t))})),this}}),Ft=Nt,$t=Ft.extend({builder:null,model:null,template:wp.template("glsrt-field"),attributes:function(){return{"data-id":this.model.cid,"data-index":this.model.get("index"),"data-level":this.model.get("level"),tabindex:0}},initialize:function(e){_.extend(this,_.pick(e,"builder")),this.model.view=this},render:function(){return this.$el.addClass("draggable"),this.setAppearance(),this.renderTag(),this},renderTag:function(){var e=this.builder.metabox.addon.tags.tags.collection.findWhere({tag:this.model.get("tag")});if(e){var t=e.get("value"),i=t;if("textarea"===e.get("type")){var n=this.builder.metabox.settings.collections.presentation.findWhere({name:"excerpt_action"}),o=this.builder.metabox.settings.collections.presentation.findWhere({name:"excerpt_length"});"disabled"!==n.get("value")&&(t=s(i,o.get("value")))}this.$el.html(this.template(_.extend(e.toJSON(),{text:t,value:i})))}else this.$el.html("{{ unknown tag }}");return this}}),Bt=$t,Pt=Backbone.Model.extend({modelView:null,parent:null,isContainer:function(){return!1},isField:function(){return!1},validate:function(e,t){return e=_.pick(e,_.keys(this.defaults)),!0}}),It=Pt.extend({defaults:{flex:"",index:0,is_bold:!1,is_hidden:!1,is_italic:!1,is_uppercase:!1,level:0,tag:"",text:"normal"},modelView:Bt,isContainer:function(){return!1},isField:function(){return!0},isRoot:function(){return!1}}),jt=Backbone.Model.extend({defaults:{custom:!1,tag:"",tag_label:"",type:"",value:""},view:null}),Rt=Backbone.Collection.extend({model:jt}),Lt=Backbone.View.extend({className:"button button-secondary",tagName:"button",events:{click:"onClick"},builder:null,model:null,initialize:function(e){_.extend(this,_.pick(e,"builder")),this.model.view=this},onClick:function(e){var t=this;e.preventDefault();var i=new It({index:this.builder.collection.where((function(e){return 1==e.get("level")})).length,level:1,tag:this.builder.metabox.addon.tags.tags.collection.get(e.currentTarget.dataset.id).get("tag")});i.parent=this.builder.collection.findWhere((function(e){return 0==e.get("level")})),this.builder.collection.add(i),setTimeout((function(){t.builder.activate(),t.builder.fields.deselectField(),t.builder.fields.selectField(i)}),100)},render:function(){return this.$el.attr("data-id",this.model.cid),this.$el.attr("tabindex",0),this.$el.html(this.model.get("tag")),this}}),Vt=Lt,Wt=Backbone.View.extend({el:"#glsrt-tags",template:null,metabox:null,collection:null,sortable:null,initialize:function(e){_.extend(this,_.pick(e,"metabox")),this.collection=new Rt},initSortable:function(){var e=this;this.sortable&&this.sortable.destroy(),this.sortable=new ut(this.el,{group:{name:"container",pull:"clone",put:!1},sort:!1,touchStartThreshold:4,forceFallback:!0,onStart:function(t){e.metabox.theme.trigger("builder:activate"),e.metabox.theme.trigger("builder:deselect-field")},onEnd:function(t){if("clone"===t.pullMode){var i=ut.get(t.to).toArray(),n=e.metabox.theme.builder.collection.get(t.to.dataset.id),o=new It({index:t.newIndex,level:n.get("level")+1,tag:e.collection.get(t.item.dataset.id).get("tag")});o.parent=n,_.each(i,(function(t,i){var n=e.metabox.theme.builder.collection.get(t);void 0!==n&&n.set("index",i,{silent:!0})})),e.metabox.theme.builder.collection.add(o),setTimeout((function(){return e.metabox.theme.builder.fields.selectField(o)}),100)}else e.metabox.theme.trigger("builder:deactivate")}})},render:function(){var e=this;return this.$el.html(""),this.collection.reset(this.metabox.data),this.collection.each((function(t){var i=new Vt({builder:e.metabox.theme.builder,model:t});e.$el.append(i.render().el)})),this}}),Xt=Wt,Yt=Backbone.View.extend({el:"#glsrt-metabox-tags",data:{},events:{"click #glsrt-tags-hidden button":"openBuilder"},addon:null,forms:null,tags:null,theme:null,initialize:function(e){_.extend(this,_.pick(e,"addon")),this.forms=new E({metabox:this}),this.tags=new Xt({metabox:this})},openBuilder:function(){this.theme.trigger("toggle:group","builder")},render:function(){this.listenTo(this.theme,"sortable",this.tags.initSortable.bind(this.tags)),this.listenTo(this.theme,"toggle:group",this.toggleGroup),this.tags.render(),this.$el.find("#glsrt-tags-hidden").show(),this.$el.find(".loading-content").hide()},toggleGroup:function(e){var t="builder"===e?"show":"hide",i="builder"===e?"hide":"show";this.forms.$el[t](),this.tags.$el[t](),this.$el.find("#glsrt-tags-hidden")[i]()}}),zt=Ft.extend({builder:null,model:null,sortable:null,attributes:function(){return{"data-container":this.model.get("direction"),"data-id":this.model.cid,"data-index":this.model.get("index"),"data-level":this.model.get("level"),tabindex:0}},initialize:function(e){_.extend(this,_.pick(e,"builder")),this.model.view=this,this.listenTo(this.builder.metabox,"sortable",this.initSortable)},initSortable:function(){var e=this;this.sortable&&this.sortable.destroy(),this.sortable=new ut(this.el,{animation:150,emptyInsertThreshold:0,filter:".glsrt-themebox:not(.is-active) [data-id]",group:"container",invertSwap:!0,preventOnFilter:!1,revertOnSpill:!0,touchStartThreshold:4,onAdd:function(e){},onChange:function(e){},onClone:function(e){},onEnd:function(t){e.builder.collection.get(t.item.dataset.id).parent=e.builder.collection.get(t.to.dataset.id),e.builder.fields.reset(),e.builder.fields.render()},onFilter:function(e){},onMove:function(e,t){},onRemove:function(e){},onSort:function(e){},onStart:function(t){e.builder.isActive||e.builder.activate(),e.builder.fields.selectFieldById(t.item.dataset.id)},onUpdate:function(e){}})},render:function(){return this.setAppearance(),this.model.parent?this.$el.addClass("draggable"):this.$el.attr("aria-label",wp.i18n._x("Drag and drop or click a template tag to add it to the review.","admin-text","site-reviews-themes")),this},renderTag:function(){return this}}),Qt=Pt.extend({defaults:{align:"stretch",direction:"col",flex:"grow",gap:12,index:0,level:0,minwidth:0,wrap:!1},modelView:zt,isContainer:function(){return!0},isField:function(){return!1},isRoot:function(){return 0===this.get("index")&&0===this.get("level")&&!this.parent},reset:function(){return this.set(this.defaults,{silent:!0}),this},toggleDirection:function(){var e="row"===this.get("direction")?"col":"row";return this.set({direction:e},{silent:!0}),this}}),Gt=Backbone.Collection.extend({comparator:function(e,t){var i=e.get("level"),n=t.get("level");this.sortReverse&&(i*=-1,n*=-1);var o=i-n;return 0===o?e.get("index")<t.get("index")?-1:1:o},consolidate:function(){var e=this;this.sortDesc({silent:!0});var t=[];if(this.each((function(i){if(!i.isField()&&!i.isRoot()){var n=e.filter((function(e){return e.parent===i})),o=_.findWhere(t,(function(e){return e.cid===i.cid}));_.isEmpty(n)&&!o&&t.push(i)}})),!_.isEmpty(t))return this.remove(t,{silent:!0}),void this.consolidate();this.sortAsc({silent:!0})},initialize:function(){this.sortReverse=!1},model:function(e){return e.tag?new It(e):new Qt(e)},populate:function(e,t){var i=this;if(_.isEmpty(e))this.add(new Qt);else{var n=t?t.get("level")+1:0;_.each(e,(function(e,o){var r=_.clone(e),l=r.children;delete r.children,r.index=o,r.level=n;var a=i.add(r);a.parent=t||null,l&&i.populate(l,a)}))}},purge:function(e){var t=this;this.each((function(i){i&&!i.isContainer()&&(e.findWhere({tag:i.get("tag")})||t.remove(i,{silent:!0}))}))},sortAsc:function(e){this.sortReverse=!1,this.sort(e)},sortDesc:function(e){this.sortReverse=!0,this.sort(e)}}),Ht=Gt,Ut={boxshadow:function(e){var t=h(e);if(!1===t)return"";var i=_.chain(t).first(4).map((function(e){return e+"px"})).value();return i.push(_.last(t)),i.join(" ")},color:function(e){return e||""},dimensions:function(e){var t=p(e);if(!1===t)return 0;var i=t[4];return _.chain(t).first(4).map((function(e){return e+i})).value().join(" ")},none:function(e){return e},px:function(e){return _.isNaN(+e)?"":e+"px"},unit:function(e){return e||""}},Jt=function(e,t,i){if(!_.isEmpty(t.property)&&!_.isArray(t.property)){var n=[t.property],o=[t.validate||"none"],r=[Ut[o](i)];e.$el.css(_.object(n,r))}},Kt=function(e){_.each(e.settings.values(),(function(t,i){if(_.isArray(t.theme)){if("ratingcolors"===t.type){var n=g(t.value);_.each(t.theme,(function(t,i){return Jt(e,t,n[i])}))}if("typography"===t.type){var o=f(t.value);if(!1===o)return;var r=t.theme[0],l=t.theme[1],a=o[2],s=t.theme[3];Jt(e,r,o[0]+a),Jt(e,l,o[1]+a),Jt(e,s,o[3])}}else _.isObject(t.theme)?Jt(e,t.theme,t.value):"rating_image"===i&&e.$el.find("[data-rating]").each((function(e,i){i.setAttribute("data-stars",t.value),i.setAttribute("style","")})).find("span:not(.screen-reader-text)").each((function(i,n){var o=t.value+"-"+jQuery(n).parent().data("rating"),r=_.get(e.stars,o,_.get(e.stars,t.value,""));r&&(r=r.replaceAll("gl-gradient",_.uniqueId("gl-"))),jQuery(n).html(r)}))}))},qt=new function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=0,i=0;return{start:function(e){t=e.clientX,i=e.clientY},isClick:function(n){var o=Math.abs(n.clientX-t),r=Math.abs(n.clientY-i);return o<e&&r<e}}},Zt=Backbone.View.extend({el:"#glsrt-fields",events:{"focus [data-id]":"onFocusField","mousedown [data-id]":"onMousedownField","mouseup [data-id]":"onMouseupField"},builder:null,isClick:!1,selectedModel:null,initialize:function(e){_.extend(this,_.pick(e,"builder")),this.listenTo(this.builder.metabox,"builder:deselect-field",this.deselectField)},deselectField:function(){this.selectedModel&&(this.selectedModel=null,this.$el.find("[data-id]").removeClass("is-selected")),this.builder.isActive?(this.builder.renderToolbar(),this.builder.metabox.trigger("tippy")):this.builder.removeToolbar()},highlightField:function(){this.selectedModel&&this.selectedModel.view.$el.addClass("is-selected")},moveField:function(e){if(~["up","down"].indexOf(e)){var t=this.selectedModel.parent.view.sortable,i=this.selectedModel.cid,n=t.toArray(),o=n.indexOf(i),r="up"===e?o-1:o+1;r<0||r===n.length||(n.splice(o,1),n.splice(r,0,i),t.sort(n,!1),this.reset(),this.render(),this.selectedModel&&(this.isClick=!0,this.selectedModel.view.el.focus(),this.isClick=!1))}},onFocusField:function(e){this.isClick||qt.isClick(e)||this.onSelectField(e)},onMousedownField:function(e){this.isClick=!0,qt.start(e)},onMouseupField:function(e){var t=this;this.isClick=!1,this.eventFired||(this.eventFired=!0,setTimeout((function(){return t.eventFired=!1}),200),e.button>0||qt.isClick(e)&&(this.builder.isActive?this.onSelectField(e):(this.builder.activate(),this.builder.renderToolbar(),this.builder.metabox.trigger("tippy"))))},onSelectField:function(e){e.preventDefault(),e.stopPropagation();var t=this.builder.collection.get(e.currentTarget.dataset.id);if(t){var i=this.selectedModel;this.deselectField(),t!==i&&this.selectField(t)}},removeField:function(){var e=this;this.selectedModel&&(this.selectedModel.view.$el.find("[data-id]").each((function(t,i){var n=e.builder.collection.get(i.dataset.id);n&&e.builder.collection.remove(n,{silent:!0})})),this.builder.collection.remove(this.selectedModel,{silent:!0}),0===this.builder.collection.length&&this.builder.collection.add(new Qt,{silent:!0}),1===this.builder.collection.length?(this.selectedModel=this.builder.collection.at(0),this.selectedModel.reset()):this.selectedModel=null,this.builder.metabox.refresh())},render:function(){var e=this,t=this.$el.find(".glsr-review");t.html(""),this.builder.collection.each((function(i){var n=new i.modelView({builder:e.builder,model:i}).render().el;i.parent?i.parent.view.$el.append(n):t.append(n)})),1===this.builder.collection.length&&this.builder.$el.addClass("is-active"),this.highlightField(),Kt(this.builder.metabox.addon.theme),this.builder.metabox.trigger("sortable")},reset:function(){this.resetChildren(this.$el.children(),0),this.builder.syncData()},resetChildren:function(e,t){var i=this;e.each((function(e,n){var o=i.builder.collection.get(n.dataset.id);o?(o.set({index:e,level:t},{silent:!0}),i.resetChildren(jQuery(n).children(),t+1)):i.resetChildren(jQuery(n).children(),t)}))},selectField:function(e){this.selectedModel=e,this.highlightField(),this.builder.renderToolbar(),this.builder.metabox.trigger("tippy")},selectFieldById:function(e){var t=this.builder.collection.get(e);t&&(t!==this.selectedModel&&(this.deselectField(),this.selectField(t)))},wrapField:function(){var e=this.builder.fields.selectedModel;if(e){var t=this.builder.collection.add(new Qt,{silent:!0}),i=new zt({model:t,builder:this.builder}).render();e.parent&&(t.parent=e.parent),i.$el.insertBefore(e.view.$el),e.parent=t,e.view.$el.appendTo(i.$el),this.reset(),this.render()}}}),ei=Zt,ti=Backbone.View.extend({el:"#glsrt-toolbar",template:wp.template("glsrt-toolbar"),events:{"change input[data-action=gap]":"onChangeGap","change input[data-action=minwidth]":"onChangeMinWidth","click [data-action=align]":"onAlign","click [data-action=direction]":"onFlexDirection","click [data-action=flex]":"onFlex","click [data-action=flex-wrap]":"onFlexWrap","click [data-action=is_bold]":"onToggleBold","click [data-action=is_hidden]":"onToggleHidden","click [data-action=is_italic]":"onToggleItalic","click [data-action=is_uppercase]":"onToggleUppercase","click [data-action=remove]":"onRemoveField","click [data-action=text]":"onText","click [data-action=wrap]":"onWrapField","input input[data-action=gap]":"onChangeGap","input input[data-action=minwidth]":"onChangeMinWidth"},builder:null,initialize:function(e){_.extend(this,_.pick(e,"builder"))},onAlign:function(e){this.toggleButton("align",e.currentTarget.dataset.value,e,"stretch")},onChangeGap:function(e){if(this.builder.fields.selectedModel&&!e.currentTarget.disabled){this.builder.fields.selectedModel.set({gap:e.target.value},{silent:!0}),this.builder.syncData();var t=this.builder.fields.selectedModel.get("gap");this.builder.fields.selectedModel.view.$el.css({gap:t?t+"px":""})}},onChangeMinWidth:function(e){if(this.builder.fields.selectedModel&&!e.currentTarget.disabled){this.builder.fields.selectedModel.set({minwidth:e.target.value},{silent:!0}),this.builder.syncData();var t=this.builder.fields.selectedModel.get("minwidth");this.builder.fields.selectedModel.view.$el.css({minWidth:t?t+"px":""})}},onFlex:function(e){this.toggleButton("flex",e.currentTarget.dataset.value,e)},onFlexDirection:function(e){var t=this.builder.fields.selectedModel;t.toggleDirection(),t.view.$el.removeClass(l("direction")),t.view.$el.addClass(l("direction",t.get("direction"))),this.builder.syncData(),this.builder.renderToolbar(),this.builder.metabox.trigger("tippy")},onFlexWrap:function(e){this.toggleButton("wrap",!0,e,!1)},onText:function(e){var t=e.currentTarget.dataset.value;this.toggleButton("text",t,e,t)},onToggleBold:function(e){this.toggleButton("is_bold",!0,e,!1)},onToggleHidden:function(e){this.toggleButton("is_hidden",!0,e,!1)},onToggleItalic:function(e){this.toggleButton("is_italic",!0,e,!1)},onToggleUppercase:function(e){this.toggleButton("is_uppercase",!0,e,!1)},onRemoveField:function(e){this.builder.fields.removeField()},onWrapField:function(e){e.currentTarget.disabled||this.builder.fields.wrapField()},render:function(){if(this.builder.isActive){var e={is_container:!1,is_root:!1,model:{},parent:{}},t=this.builder.fields.selectedModel;t&&(e.is_container=t.isContainer(),e.is_root=0===t.get("level"),e.model=t.toJSON(),t.parent&&(e.parent=t.parent.toJSON())),this.$el.html(this.template(e))}},toggleButton:function(e,t,i,n){var o=this.builder.fields.selectedModel;if(o&&!i.currentTarget.disabled){var r=jQuery(i.currentTarget),a={};a[e]=n||"",r.parent().find("button").removeClass("is-pressed").attr("aria-pressed",!1),t===o.get(e)&&t!==n||(a[e]=t,r.addClass("is-pressed").attr("aria-pressed",!0)),o.set(a,{silent:!0}),o.view.$el.removeClass(l(e)),o.get(e)&&o.view.$el.addClass(l(e,a[e])),this.builder.syncData(),i.currentTarget.blur()}}}),ii=Backbone.View.extend({el:"#glsrt-builder",data:{fields:[],styles:[]},isActive:!1,collection:null,fields:null,metabox:null,toolbar:null,initialize:function(e){_.extend(this,_.pick(e,"metabox")),this.collection=new Ht,this.fields=new ei({builder:this}),this.toolbar=new ti({builder:this}),this.listenTo(this,"document:click",this.onDocumentClick),this.listenTo(this,"document:keydown",this.onDocumentKeydown),this.listenTo(this,"document:keyup",this.onDocumentKeyup),this.listenTo(this.metabox,"builder:activate",this.activate),this.listenTo(this.metabox,"builder:deactivate",this.deactivate),this.listenTo(this.metabox,"builder:purge",this.purgeCollection)},activate:function(){this.isActive=!0,this.$el.addClass("is-active")},deactivate:function(){this.isActive=!1,this.fields.deselectField(),this.collection.length>1&&this.$el.removeClass("is-active")},onDocumentClick:function(e){this.metabox.el.contains(e.target)||this.metabox.addon.tags.el.contains(e.target)||!document.contains(e.target)||this.deactivate()},onDocumentKeydown:function(e){if(this.fields.selectedModel&&this.fields.selectedModel.parent){var t=this.fields.selectedModel.parent.get("direction");("col"!==t||~["ArrowUp","ArrowDown"].indexOf(e.key))&&("row"!==t||~["ArrowLeft","ArrowRight"].indexOf(e.key))&&(e.key,e.preventDefault(),this.fields.moveField(~["ArrowUp","ArrowLeft"].indexOf(e.key)?"up":"down"))}},onDocumentKeyup:function(e){~["Escape"].indexOf(e.key)?this.pressEscape():~["Tab"].indexOf(e.key)&&!this.fields.el.contains(e.target)?this.pressTab():~["Delete"].indexOf(e.key)&&!e.currentTarget.disabled&&this.pressDelete()},purgeCollection:function(e){var t=this;this.collection.purge(e),this.collection.each((function(e){t.fields.selectedModel&&e.cid===t.fields.selectedModel.cid&&t.metabox.trigger("builder:deselect-field")}))},pressDelete:function(){this.fields.removeField()},pressEscape:function(){this.fields.selectedModel?this.fields.deselectField():this.deactivate()},pressTab:function(){this.fields.selectedModel&&this.fields.deselectField()},removeToolbar:function(){this.toolbar&&(this.toolbar.stopListening(),this.toolbar.$el.html(""))},render:function(){this.syncData(),this.fields.render()},renderToolbar:function(){this.toolbar.render()},syncData:function(){0===this.collection.length&&this.collection.populate(this.data.fields),this.collection.consolidate(),this.collection.sortDesc({silent:!0});for(var e=this.collection.isEmpty()?0:this.collection.max((function(e){return e.get("level")})).get("level"),t=[],i={};e>=0;)_.each(this.collection.where({level:e}),(function(e){var n=e.toJSON();delete n.index,delete n.level,i[e.cid]&&(n.children=i[e.cid]),e.parent?(i[e.parent.cid]||(i[e.parent.cid]=[]),i[e.parent.cid].push(n)):t=[n]})),e--;this.data.fields=t,this.collection.sortAsc({silent:!0}),this.$el.find("[data-builder]").val(JSON.stringify(t))}}),ni=ii,oi=Backbone.View.extend({className:"srt-review-placeholder",template:wp.template("glsrt-preview-placeholder"),render:function(){return this.$el.html(this.template()),this}}),ri=GLSR.addons[r],li=Backbone.View.extend({collection:null,el:"#glsrt-preview",display:12,swiper:null,template:wp.template("glsrt-preview"),metabox:null,initialize:function(e){_.extend(this,_.pick(e,"metabox")),this.collection=new Ht},render:function(){var e=this,t=_.get(this.metabox.settings.getSettings(),["presentation","layout"]);this.$el.html(this.template({has_reviews:this.metabox.reviews.length===this.display,layout:t,swiper:ri.swiper}));var i=this.$el.find(".gl-reviews");return i.html(""),this.collection.reset(),this.collection.populate(this.metabox.builder.data.fields),_.each(_.range(this.display),(function(n,o){var r=e.buildReview(o);r.addClass("glsr-review"),"carousel"===t.display_as&&(r.addClass("gl-slide"),"splide"===ri.swiper&&r.addClass("splide__slide")),i.append(r)})),this.initCarousel(t),this.metabox.trigger("set-locale-dir"),this},buildReview:function(e){var t=this,i=jQuery(document.createElement("div")),n=_.get(this.metabox.reviews,e);if(n&&this.metabox.builder.collection.length>1)this.collection.each((function(e){var o=new Ft({builder:t.metabox.builder,model:e,review:n});o.render(),e.parent?e.parent.view.$el.append(o.el):i.html(o.el)}));else{var o=new oi;i.html(o.render().el)}return i},initCarousel:function(e){this.swiper&&(this.swiper.destroy(),this.swiper=null),"carousel"===e.display_as&&("splide"===ri.swiper?(this.swiper=d(".gl-splide",{gap:+e.spacing,maxslides:+e.max_slides,navigation:!!~e.swiper_options.indexOf("navigation"),pagination:!!~e.swiper_options.indexOf("pagination")}),this.swiper.on("ready",(function(){setTimeout((function(){GLSR.Event.trigger("site-reviews-themes/swiper/resize")}),25)})),this.swiper.mount()):"swiper"===ri.swiper&&(this.swiper=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.autoplay,n=void 0!==i&&i,o=t.breakpoints,r=void 0===o?{}:o,l=t.cssMode,a=void 0!==l&&l,s=t.enabled,d=void 0===s||s,c=t.navigation,u=void 0!==c&&c,h=t.pagination,p=void 0!==h&&h,g=t.spaceBetween,f={breakpoints:r,breakpointsBase:"container",cssMode:a,enabled:d,grabCursor:!0,init:!1,navigation:{enabled:u,nextEl:".gl-swiper-next",prevEl:".gl-swiper-prev"},noSwipingSelector:"a",pagination:{bulletActiveClass:"is-active",bulletClass:"gl-swiper-bullet",bulletElement:"button",clickable:!0,el:".gl-swiper-pagination",enabled:p},slideActiveClass:"is-active",slideBlankClass:"gl-slide-invisible-blank",slideClass:"gl-slide",slideNextClass:"gl-slide-next",slidePrevClass:"gl-slide-prev",slidesPerView:1,spaceBetween:void 0===g?16:g,wrapperClass:"gl-swiper-wrapper"};return n&&(f.autoplay={disableOnInteraction:!1,enabled:!0,pauseOnMouseEnter:!0},f.loop=!0),new Swiper(e,f)}(".gl-swiper",{breakpoints:u(+e.max_slides),navigation:!!~e.swiper_options.indexOf("navigation"),pagination:!!~e.swiper_options.indexOf("pagination"),spaceBetween:+e.spacing}),this.swiper.init()))}}),ai=li,si=Backbone.View.extend({el:"#glsrt-metabox-theme",data:{},group:"preview",addon:null,builder:null,navigation:null,preview:null,reviews:null,settings:null,stars:null,initialize:function(e){_.extend(this,_.pick(e,"addon")),this.builder=new ni({metabox:this}),this.navigation=new v({metabox:this}),this.preview=new ai({metabox:this})},refresh:function(){this.$el.find("#glsrt-"+this.group).show(),this.builder.render(),this.builder.fields.el.dataset.count=this.builder.collection.length,this.preview.render(),Kt(this)},render:function(){return this.listenTo(this,"theme:refresh",_.debounce(this.refresh,5)),this.listenTo(this,"toggle:group",this.toggleGroup),this.refresh(),this.navigation.render(),this.listenTo(this.builder.collection,"all",_.debounce(this.refresh,50)),this},toggleGroup:function(e){var t=this;this.group!==e&&(this.group=e,_.each(this.data,(function(e,i){return t.$el.find("#glsrt-"+i).hide()})),this.$el.find("#glsrt-"+e).show(),"preview"===e&&(this.preview.render(),Kt(this)))}}),di=GLSR.addons["site-reviews-themes"],ci=Backbone.View.extend({el:"#poststuff",tippy:[],settings:null,tags:null,theme:null,initialize:function(){var e=this;if(this.el){try{this.settings=new S({addon:this}),this.tags=new Yt({addon:this}),this.theme=new si({addon:this})}catch(e){var t=_.template('<div style="display:flex;width:100%;align-items:center;"><i class="dashicons-before dashicons-warning" style="color:#d63638; margin-right:.5em;"></i> <%= msg %></div>');return this.$(".loading-content").html(t({msg:di.error.basic})),this.$("#glsrt-metabox-theme .loading-content").html(t({msg:di.error.detailed})),void console.error("Review Themes: a plugin or theme is interfering with the admin_footer hook.")}wp.ajax.post(GLSR.action,a("theme")).then((function(t){e.settings.theme=e.theme,e.tags.theme=e.theme,e.theme.settings=e.settings,e.settings.data=t.settings,e.tags.data=t.tags,e.theme.builder.data=t.theme.builder.data,e.theme.data=t.theme,e.theme.reviews=t.reviews,e.theme.stars=t.stars,e.listenTo(e.settings,"colorpicker",e.initColorpickers),e.listenTo(e.theme,"set-locale-dir",e.initTextDirection),e.listenTo(e.settings,"tippy",e.initTippy),e.listenTo(e.tags,"tippy",e.initTippy),e.listenTo(e.theme,"tippy",e.initTippy),e.settings.render(),e.tags.render(),e.theme.render()})).then((function(){jQuery(document).on("click",(function(t){return e.theme.builder.trigger("document:click",t)})),jQuery(document).on("keyup",(function(t){return e.theme.builder.trigger("document:keyup",t)})),jQuery(document).on("keydown",(function(t){e.settings.trigger("document:keydown",t),e.theme.builder.trigger("document:keydown",t)})),e.initColorpickers(),e.initTippy(),e.theme.trigger("sortable")}))}},initTextDirection:function(){this.$(".glsr").each((function(e,t){jQuery(t).addClass("glsr-"+window.getComputedStyle(t,null).getPropertyValue("direction"))}))},initColorpickers:function(){this.$(".glsr-color-picker").wpColorPicker({change:function(e,t){jQuery(e.target).val(t.color.to_s()).trigger("change:colorpicker")},palettes:di.palettes,width:244}),this.$(".glsr-color-picker").each((function(e,t){var i=jQuery(t).closest(".wp-picker-container");i.addClass("glsr-wp-picker-container"),i.find(".wp-color-result-text").text(jQuery(t).data("text")),i.find(".wp-picker-input-wrap").appendTo(i.find(".wp-picker-holder")),i.find("button").attr("data-tippy-content",t.dataset.tippyContent),i.find("button").attr("data-tippy-allowHTML",!0),i.find(".wp-color-result").on("click",(function(e){var t=jQuery(this).parent().find(".wp-picker-holder");if(t){t.css("left",0);var i=t[0].getBoundingClientRect(),n=Math.ceil(window.innerWidth-i.width-i.left);n<0&&t.css("left",n)}}))}))},initTippy:function(){_.each(this.tippy,(function(e){return e.destroy()})),this.tippy=GLSR.Tippy.tippy(this.el.querySelectorAll("#wpbody [data-tippy-content]"),{delay:[200,null],plugins:[GLSR.Tippy.plugins.followCursor]})}}),ui=GLSR.addons["site-reviews-themes"];jQuery((function(e){ui.ui=new ci,e("code[data-select-text]").on("click",(function(e){!function(e){if(window.getSelection){var t=window.getSelection(),i=document.createRange();i.selectNodeContents(e),t.removeAllRanges(),t.addRange(i)}}(e.currentTarget)})),function(){var e=document.createElement("div");e.style.display="flex",e.style.flexDirection="column",e.style.rowGap="1px",e.appendChild(document.createElement("div")),e.appendChild(document.createElement("div")),document.body.appendChild(e);var t=1===e.scrollHeight;return e.parentNode.removeChild(e),t}()&&e("html").addClass("gl-flexbox-gap")}))}();