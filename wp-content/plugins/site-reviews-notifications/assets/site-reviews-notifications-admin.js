!function(){var e,t={377:function(){window.crypto||(window.crypto=window.msCrypto)},257:function(e,t,i){"use strict";i(377);var n=GLSR.addons["site-reviews-notifications"];function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var s=function(e){return!(_.isNull(e)||_.isUndefined(e)||_.isString(e)&&""===jQuery.trim(e)||_.isArray(e)&&_.isEmpty(e))},a={between:function(e,t,i,r){if(s(e)&&(!jQuery.isNumeric(e)||+e<r[0]||+e>r[1]))return wp.i18n.sprintf(n.messages.between,n.labels[t],r[0],r[1])},criteria:function(e,t,i){var r=(e||"").split("|");if("always"!==r[0]&&1===r.length)return wp.i18n.sprintf(n.messages.criteria,n.labels[t])},number:function(e,t,i){if(s(e)&&!jQuery.isNumeric(e))return wp.i18n.sprintf(n.messages.number,n.labels[t])},required:function(e,t,i){if(!s(e))return wp.i18n.sprintf(n.messages.required,n.labels[t])},unique:function(e,t,i){var r=_.filter(i.collection.where(o({},t,e)),(function(e){return e.cid!==i.cid}));if(s(e)&&r.length)return wp.i18n.sprintf(n.messages.unique,n.labels[t])}};let l=e=>crypto.getRandomValues(new Uint8Array(e)),c=(e,t=21)=>((e,t,i)=>{let n=(2<<Math.log(e.length-1)/Math.LN2)-1,r=-~(1.6*n*t/e.length);return(o=t)=>{let s="";for(;;){let t=i(r),a=r;for(;a--;)if(s+=e[t[a]&n]||"",s.length===o)return s}}})(e,t,l);var u=Backbone.Model.extend({defaults:function(){return{conditions:"always",enabled:!1,heading:"",message:"",recipients:[],schedule:0,subject:"",uid:c("1234567890abcdef",13)()}},errors:{},expanded:!1,toggle:function(e){return this.expanded=_.isBoolean(e)?e:!this.expanded,this},validate:function(e){var t=this;if(this.errors={},_.each(n.validation,(function(i,n){_.each(i,(function(i,r){var o=a[r](e[n],n,t,i);o&&(t.errors[n]=o)}))})),!_.isEmpty(this.errors))return console.error(this.errors),"invalid"}}),d=Backbone.Collection.extend({model:u});var h={classes:{active:"is-active",criteria:"glsr-criteria",error:"glsrn-field-error",expanded:"is-expanded",field:"glsr-metabox-field",highlighted:"is-highlighted",input:"glsr-input",invalid:"is-invalid",mb:"glsr-search-multibox",mb_entries:"glsr-selected-entries",mb_entry:"glsr-multibox-entry",mb_input:"glsr-search-input",mb_remove:"glsr-remove-button",mb_result:"glsr-search-result",mb_results:"glsr-search-results",notifications:"gl-tbody",placeholder:"glsrn-placeholder",preview_active:"preview-active",removing:"is-removing",settings:"gl-settings"},contains:function(e,t){return e.classList.contains(this.classes[t]||t)},encode:function(e){return JSON.stringify(e)},escapeHtml:function(e){return e.replace(/[&<>'"]/g,(function(e){return"&#"+e.charCodeAt(0)+";"}))},selector:function(e){return"."+this.classes[e]||0}};function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function p(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function g(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=f(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=f(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==f(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var m=Backbone.View.extend({className:"glsr-criteria-condition",template:wp.template("glsrn-criteria-condition"),events:{"change select[data-condition=field]":"onChangeField","change select[data-condition=operator]":"onChange","change select[data-condition=value]":"onChange","keyup input[data-condition=value]":"onChange","click .glsr-remove-condition":"onRemove"},initialize:function(){this.listenTo(this.model,"destroy",this.remove)},render:function(){return this.$el.html(this.template(this.data())),this},data:function(){var e=this.model.toJSON(),t=n.criteria.fields,i=_.get(n.criteria.restrictions,e.field,{}),r=_.pick(n.criteria.operators,i.operators||[]),o=_.pick(n.criteria.values,i.values||[]),s=this.model.previous("field"),a=!_.isUndefined(s)&&e.field!==s;return _.isEmpty(r)?a&&(e.operator=""):_.isUndefined(r[e.operator])&&(e.operator=_.keys(r).shift()),_.isEmpty(o)?a&&(e.value=""):_.isUndefined(o[e.value])&&(e.value=_.keys(o).shift()),this.model.set(e,{silent:!0}),function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?p(Object(i),!0).forEach((function(t){g(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):p(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({fields:t,operators:r,values:o},this.model.toJSON())},onChange:function(e){var t=e.target.dataset.condition,i=e.target.value;this.model.set(t,i)},onChangeField:function(e){this.onChange(e),this.render()},onRemove:function(e){e.preventDefault(),this.model.destroy()}}),v=m,b=Backbone.Model.extend({defaults:{field:"",operator:"",value:""}}),y=Backbone.Collection.extend({model:b}),w=Backbone.View.extend({collection:null,criteria:[],key:null,selected:"",template:wp.template("glsrn-criteria"),events:{"change .glsr-criteria-option select":"onChange","click .glsr-add-condition":"onAddCondition"},initialize:function(e){_.extend(this,_.pick(e,"key")),this.collection=new y,this.listenTo(this.collection,"add",this.update),this.listenTo(this.collection,"change",this.update),this.listenTo(this.collection,"remove",this.update)},render:function(){this.selected=this.model.get(this.key).split("|").shift()||"always";var e={cid:this.model.cid,selected:this.selected,conditions:n.criteria.conditions,key:this.key};return this.$el.html(this.template(e)),this.addConditions(),"always"===this.selected&&this.$(".glsr-add-condition").hide(),this},addCondition:function(e){if(_.isEmpty(e)){var t=_.keys(n.criteria.fields).shift(),i=_.get(n.criteria.restrictions,t,[]);e={field:t,operator:_.keys(_.pick(n.criteria.operators,i.operators)).shift()}}var r=new b(e),o=new v({model:r});this.$(".glsr-criteria-conditions").append(o.render().el),this.collection.add(r)},addConditions:function(){var e=this,t=this.model.get(this.key).split("|");t.shift(),_.map(t,(function(t){var i=_.object(["field","operator","value"],t.split(":"));e.addCondition(i)})),this.model.trigger("model:validate:reset",this.el)},onAddCondition:function(e){e.preventDefault(),this.addCondition(),this.model.trigger("model:validate:reset",this.el)},onChange:function(e){this.selected=e.target.value;var t="always"===this.selected?"hide":"show",i=this.$(".glsr-criteria-conditions");this.$(".glsr-add-condition")[t](),i[t](),"show"===t&&0===i.children().length?this.addCondition():this.model.trigger("model:validate:reset",e.target),this.update()},update:function(e,t,i){var n=this.$(".glsr-criteria-conditions"),r=[this.selected];this.collection.each((function(e){var t=e.toJSON();r.push(t.field+":"+t.operator+":"+t.value)})),this.model.set(this.key,r.join("|"),{silent:!0}),this.model.trigger("model:change"),n.find(".glsr-remove-condition").prop("disabled",n.children().length<2)}}),k=["Down","Enter","Esc","Up"],x=["Tab"],C=Backbone.View.extend({key:null,options:[],restricted:!1,template:wp.template("glsrn-multibox"),templateEntry:wp.template("glsrn-multibox-entry"),events:{"focus .glsr-search-input":"onClickInside","input .glsr-search-input":"onSearch","click .glsr-remove-button":"onRemove","click .glsr-search-result":"onSelect","mouseleave .glsr-search-result":"onMouseleave","mouseover .glsr-search-result":"onMouseover"},initialize:function(e){_.extend(this,_.pick(e,"key","options","restricted")),this.listenTo(this.model,"model:click",this.onClickOutside),this.listenTo(this.model,"model:keydown",this.onKeydown),this.listenTo(this.model,"model:keyup",this.onKeyup),jQuery(document).on("click",this.onClickOutside.bind(this))},render:function(){this.$el.html(this.template({cid:this.model.cid,key:this.key,options:this.options})),this.refresh()},filterEntries:function(){var e=this,t=this.model.get(this.key)||[],i=this.$(h.selector("mb_input")).val();this.$(h.selector("mb_result")).each((function(n,r){var o=e.$(r),s=~t.indexOf(o.data("slug")),a=-1===o.text().toLowerCase().indexOf(i.toLowerCase());o[s||a?"hide":"show"]()}))},hideDropdown:function(){this.removeHighlighted(),this.$(h.selector("mb_results")).removeClass(h.classes.active),this.$(h.selector("mb_input")).val("").blur()},keydownDown:function(e){(h.contains(e.target,"mb_input")||h.contains(e.target,"mb_result"))&&(e.preventDefault(),this.navigateDown())},keydownEnter:function(e){var t=this.$(e.target);if(t.length)if(t.hasClass(h.classes.mb_remove))this.removeSelected(t);else if(t.hasClass(h.classes.mb_input)){var i=this.$(h.selector("mb_result")+h.selector("highlighted"));if(i.length)this.selectOption(i);else if(!this.restricted&&!_.isEmpty(t.val())){var n=this.model.get(this.key)||[];n.push(t.val()),n=_.uniq(n).sort(),this.model.set(this.key,n,{silent:!0,validate:!0}),this.refresh(),this.model.trigger("model:validate:reset",t),this.$(h.selector("mb_input")).val("").focus()}}},keydownEsc:function(e){this.$(h.selector("mb_result")).hasClass(h.classes.highlighted)?this.removeHighlighted():this.hideDropdown()},keydownUp:function(e){(h.contains(e.target,"mb_input")||h.contains(e.target,"mb_result"))&&(e.preventDefault(),this.navigateUp())},keyupTab:function(e){h.contains(e.target,"mb_input")?this.showDropdown():this.hideDropdown()},moveIntoView:function(){var e=this.$(h.selector("mb_result")).filter(h.selector("highlighted"));if(e.length){var t=e.parent(),i=t.scrollTop(),n=i+t.outerHeight(),r=e.get(0).offsetTop,o=r+e.outerHeight();r<i?t.scrollTop(r-4):o>n&&t.scrollTop(o-t.outerHeight())}},navigate:function(e){var t=this.$(h.selector("mb_result")),i=t.filter(h.selector("highlighted"));i.removeClass(h.classes.highlighted);var n=i.index()+e;if(n<0)this.$(h.selector("mb_input")).focus();else{for(;t.eq(n).is(":hidden")&&!(n<0||n>t.length);)n+=e;(n=Math.min(n,t.length-1))<0?(t.removeClass(h.classes.highlighted),this.$(h.selector("mb_input")).focus()):t.eq(n).addClass(h.classes.highlighted),this.moveIntoView()}},navigateDown:function(){this.showDropdown(),this.navigate(1)},navigateUp:function(){this.showDropdown(),this.navigate(-1)},onClickInside:function(e){this.showDropdown()},onClickOutside:function(e){var t=this.$(e.target);t.length&&t.closest("."+h.classes.mb).length||this.hideDropdown()},onKeydown:function(e){var t,i=e.key.replace(/Arrow|ape/g,"");~k.indexOf(i)&&(e.stopPropagation(),null===(t=this["keydown"+i])||void 0===t||t.call(this,e))},onKeyup:function(e){var t,i=e.key.replace(/Arrow|ape/g,"");~x.indexOf(i)&&(e.stopPropagation(),null===(t=this["keyup"+i])||void 0===t||t.call(this,e))},onMouseleave:function(e){this.$(e.currentTarget).removeClass(h.classes.highlighted)},onMouseover:function(e){this.removeHighlighted(),this.$(e.currentTarget).addClass(h.classes.highlighted)},onRemove:function(e){this.removeSelected(jQuery(e.currentTarget))},onSearch:function(e){var t=this;_.debounce((function(){t.removeHighlighted(),t.refresh()}),100)()},onSelect:function(e){this.selectOption(jQuery(e.currentTarget))},refresh:function(){this.renderEntries(),this.filterEntries()},removeHighlighted:function(){this.$(h.selector("mb_result")).removeClass(h.classes.highlighted)},removeSelected:function(e){var t=this,i=e.data("slug");if(i){var n=_.without(this.model.get(this.key)||[],i);this.model.set(this.key,n,{silent:!0}),this.model.trigger("model:change"),e.closest(h.selector("mb_entry")).css({backgroundColor:"#F1ADAD"}).fadeOut(350,(function(){t.removeHighlighted(),t.refresh(),t.$(h.selector("mb_input")).focus()}))}},renderEntries:function(){var e=this,t=this.model.get(this.key)||[],i=this.$(h.selector("mb_entries"));i.html(""),_.each(t,(function(t){var n=_.findWhere(e.options,{slug:t});i.append(e.templateEntry(n||{name:t,slug:t}))}))},selectOption:function(e){var t=e.data("slug");if(t){var i=this.model.get(this.key)||[];i.push(t),this.restricted&&(i=_.pluck(_.filter(this.options,(function(e){return~i.indexOf(e.slug)})),"slug")),i=_.uniq(i).sort(),this.model.set(this.key,i,{silent:!0,validate:!0}),this.refresh(),this.model.trigger("model:validate:reset",e),this.$(h.selector("mb_input")).focus()}},showDropdown:function(){var e=this.$(h.selector("mb_results"));e.length&&(e.hasClass(h.classes.active)||(this.removeHighlighted(),this.refresh(),e.scrollTop(0).addClass(h.classes.active)))}}),O={grad:.9,turn:360,rad:360/(2*Math.PI)},$=function(e){return"string"==typeof e?e.length>0:"number"==typeof e},j=function(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=Math.pow(10,t)),Math.round(i*e)/i+0},S=function(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=1),e>i?i:e>t?e:t},T=function(e){return(e=isFinite(e)?e%360:0)>0?e:e+360},E=function(e){return{r:S(e.r,0,255),g:S(e.g,0,255),b:S(e.b,0,255),a:S(e.a)}},N=function(e){return{r:j(e.r),g:j(e.g),b:j(e.b),a:j(e.a,3)}},D=/^#([0-9a-f]{3,8})$/i,P=function(e){var t=e.toString(16);return t.length<2?"0"+t:t},M=function(e){var t=e.r,i=e.g,n=e.b,r=e.a,o=Math.max(t,i,n),s=o-Math.min(t,i,n),a=s?o===t?(i-n)/s:o===i?2+(n-t)/s:4+(t-i)/s:0;return{h:60*(a<0?a+6:a),s:o?s/o*100:0,v:o/255*100,a:r}},H=function(e){var t=e.h,i=e.s,n=e.v,r=e.a;t=t/360*6,i/=100,n/=100;var o=Math.floor(t),s=n*(1-i),a=n*(1-(t-o)*i),l=n*(1-(1-t+o)*i),c=o%6;return{r:255*[n,a,s,s,l,n][c],g:255*[l,n,n,a,s,s][c],b:255*[s,s,l,n,n,a][c],a:r}},V=function(e){return{h:T(e.h),s:S(e.s,0,100),l:S(e.l,0,100),a:S(e.a)}},A=function(e){return{h:j(e.h),s:j(e.s),l:j(e.l),a:j(e.a,3)}},z=function(e){return H((i=(t=e).s,{h:t.h,s:(i*=((n=t.l)<50?n:100-n)/100)>0?2*i/(n+i)*100:0,v:n+i,a:t.a}));var t,i,n},R=function(e){return{h:(t=M(e)).h,s:(r=(200-(i=t.s))*(n=t.v)/100)>0&&r<200?i*n/100/(r<=100?r:200-r)*100:0,l:r/2,a:t.a};var t,i,n,r},I=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,U=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,q=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,B=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,L={string:[[function(e){var t=D.exec(e);return t?(e=t[1]).length<=4?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:4===e.length?j(parseInt(e[3]+e[3],16)/255,2):1}:6===e.length||8===e.length?{r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16),a:8===e.length?j(parseInt(e.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(e){var t=q.exec(e)||B.exec(e);return t?t[2]!==t[4]||t[4]!==t[6]?null:E({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:void 0===t[7]?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(e){var t=I.exec(e)||U.exec(e);if(!t)return null;var i,n,r=V({h:(i=t[1],n=t[2],void 0===n&&(n="deg"),Number(i)*(O[n]||1)),s:Number(t[3]),l:Number(t[4]),a:void 0===t[5]?1:Number(t[5])/(t[6]?100:1)});return z(r)},"hsl"]],object:[[function(e){var t=e.r,i=e.g,n=e.b,r=e.a,o=void 0===r?1:r;return $(t)&&$(i)&&$(n)?E({r:Number(t),g:Number(i),b:Number(n),a:Number(o)}):null},"rgb"],[function(e){var t=e.h,i=e.s,n=e.l,r=e.a,o=void 0===r?1:r;if(!$(t)||!$(i)||!$(n))return null;var s=V({h:Number(t),s:Number(i),l:Number(n),a:Number(o)});return z(s)},"hsl"],[function(e){var t=e.h,i=e.s,n=e.v,r=e.a,o=void 0===r?1:r;if(!$(t)||!$(i)||!$(n))return null;var s=function(e){return{h:T(e.h),s:S(e.s,0,100),v:S(e.v,0,100),a:S(e.a)}}({h:Number(t),s:Number(i),v:Number(n),a:Number(o)});return H(s)},"hsv"]]},Q=function(e,t){for(var i=0;i<t.length;i++){var n=t[i][0](e);if(n)return[n,t[i][1]]}return[null,void 0]},K=function(e){return"string"==typeof e?Q(e.trim(),L.string):"object"==typeof e&&null!==e?Q(e,L.object):[null,void 0]},J=function(e,t){var i=R(e);return{h:i.h,s:S(i.s+100*t,0,100),l:i.l,a:i.a}},F=function(e){return(299*e.r+587*e.g+114*e.b)/1e3/255},G=function(e,t){var i=R(e);return{h:i.h,s:i.s,l:S(i.l+100*t,0,100),a:i.a}},X=function(){function e(e){this.parsed=K(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return e.prototype.isValid=function(){return null!==this.parsed},e.prototype.brightness=function(){return j(F(this.rgba),2)},e.prototype.isDark=function(){return F(this.rgba)<.5},e.prototype.isLight=function(){return F(this.rgba)>=.5},e.prototype.toHex=function(){return t=(e=N(this.rgba)).r,i=e.g,n=e.b,o=(r=e.a)<1?P(j(255*r)):"","#"+P(t)+P(i)+P(n)+o;var e,t,i,n,r,o},e.prototype.toRgb=function(){return N(this.rgba)},e.prototype.toRgbString=function(){return t=(e=N(this.rgba)).r,i=e.g,n=e.b,(r=e.a)<1?"rgba("+t+", "+i+", "+n+", "+r+")":"rgb("+t+", "+i+", "+n+")";var e,t,i,n,r},e.prototype.toHsl=function(){return A(R(this.rgba))},e.prototype.toHslString=function(){return t=(e=A(R(this.rgba))).h,i=e.s,n=e.l,(r=e.a)<1?"hsla("+t+", "+i+"%, "+n+"%, "+r+")":"hsl("+t+", "+i+"%, "+n+"%)";var e,t,i,n,r},e.prototype.toHsv=function(){return e=M(this.rgba),{h:j(e.h),s:j(e.s),v:j(e.v),a:j(e.a,3)};var e},e.prototype.invert=function(){return W({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},e.prototype.saturate=function(e){return void 0===e&&(e=.1),W(J(this.rgba,e))},e.prototype.desaturate=function(e){return void 0===e&&(e=.1),W(J(this.rgba,-e))},e.prototype.grayscale=function(){return W(J(this.rgba,-1))},e.prototype.lighten=function(e){return void 0===e&&(e=.1),W(G(this.rgba,e))},e.prototype.darken=function(e){return void 0===e&&(e=.1),W(G(this.rgba,-e))},e.prototype.rotate=function(e){return void 0===e&&(e=15),this.hue(this.hue()+e)},e.prototype.alpha=function(e){return"number"==typeof e?W({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):j(this.rgba.a,3);var t},e.prototype.hue=function(e){var t=R(this.rgba);return"number"==typeof e?W({h:e,s:t.s,l:t.l,a:t.a}):j(t.h)},e.prototype.isEqual=function(e){return this.toHex()===W(e).toHex()},e}(),W=function(e){return e instanceof X?e:new X(e)},Y=[],Z=function(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=1),e>i?i:e>t?e:t},ee=function(e){var t=e/255;return t<.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)},te=function(e){return 255*(e>.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e)},ie=96.422,ne=82.521,re=216/24389,oe=24389/27,se=function(e){var t=function(e){var t=ee(e.r),i=ee(e.g),n=ee(e.b);return function(e){return{x:Z(e.x,0,ie),y:Z(e.y,0,100),z:Z(e.z,0,ne),a:Z(e.a)}}(function(e){return{x:1.0478112*e.x+.0228866*e.y+-.050127*e.z,y:.0295424*e.x+.9904844*e.y+-.0170491*e.z,z:-.0092345*e.x+.0150436*e.y+.7521316*e.z,a:e.a}}({x:100*(.4124564*t+.3575761*i+.1804375*n),y:100*(.2126729*t+.7151522*i+.072175*n),z:100*(.0193339*t+.119192*i+.9503041*n),a:e.a}))}(e),i=t.x/ie,n=t.y/100,r=t.z/ne;return i=i>re?Math.cbrt(i):(oe*i+16)/116,{l:116*(n=n>re?Math.cbrt(n):(oe*n+16)/116)-16,a:500*(i-n),b:200*(n-(r=r>re?Math.cbrt(r):(oe*r+16)/116)),alpha:t.a}},ae=function(e,t,i){var n,r=se(e),o=se(t);return function(e){var t=(e.l+16)/116,i=e.a/500+t,n=t-e.b/200;return function(e){var t,i,n=.9555766*(t=e).x+-.0230393*t.y+.0631636*t.z,r=-.0282895*t.x+1.0099416*t.y+.0210077*t.z,o=.0122982*t.x+-.020483*t.y+1.3299098*t.z;return i={r:te(.032404542*n-.015371385*r-.004985314*o),g:te(-.00969266*n+.018760108*r+41556e-8*o),b:te(556434e-9*n-.002040259*r+.010572252*o),a:e.a},{r:Z(i.r,0,255),g:Z(i.g,0,255),b:Z(i.b,0,255),a:Z(i.a)}}({x:(Math.pow(i,3)>re?Math.pow(i,3):(116*i-16)/oe)*ie,y:100*(e.l>8?Math.pow((e.l+16)/116,3):e.l/oe),z:(Math.pow(n,3)>re?Math.pow(n,3):(116*n-16)/oe)*ne,a:e.alpha})}({l:Z((n={l:r.l*(1-i)+o.l*i,a:r.a*(1-i)+o.a*i,b:r.b*(1-i)+o.b*i,alpha:r.alpha*(1-i)+o.alpha*i}).l,0,400),a:n.a,b:n.b,alpha:Z(n.alpha)})};!function(e){e.forEach((function(e){Y.indexOf(e)<0&&(e(X,L),Y.push(e))}))}([function(e){function t(e,t,i){void 0===i&&(i=5);for(var n=[],r=1/(i-1),o=0;o<=i-1;o++)n.push(e.mix(t,r*o));return n}e.prototype.mix=function(t,i){void 0===i&&(i=.5);var n=t instanceof e?t:new e(t),r=ae(this.toRgb(),n.toRgb(),i);return new e(r)},e.prototype.tints=function(e){return t(this,"#fff",e)},e.prototype.shades=function(e){return t(this,"#000",e)},e.prototype.tones=function(e){return t(this,"#808080",e)}}]);var le=Backbone.View.extend({className:"mce-preview",main:null,model:null,template:wp.template("glsrn-preview"),initialize:function(e){_.extend(this,_.pick(e,"main")),this.listenTo(this.main,"preview:render",this.render),this.listenTo(this.model,"model:change",this.render)},render:function(){var e=this,t="",i=this.main.settings.footer_text,n=this.model.get("heading"),r=this.model.get("message"),o=this.main.settings.header_image;return this.testImage(o).then((function(s){!0===s&&(t=jQuery("<img>").attr({src:o})[0].outerHTML),e.$el.html(e.template({footer:i,heading:n,image:t,message:r})),_.isEmpty(t)&&e.$(".email-top").hide(),_.isEmpty(n)&&e.$(".email-body_header").hide(),_.isEmpty(i)&&e.$(".email-body_footer").hide(),e.$el.css(e.getColorVariables())})),this},getColorVariables:function(){var e=this.main.settings,t={};_.each(e,(function(e,i){/color$/.test(i)&&(t["--email_"+i]=e)}));var i=W(e.background_color);if(i.isValid()){var n=i.isLight()?i.mix("#000",.25):i.mix("#fff",.75);t["--email_footer_text_color"]=n.toHex()}var r=W(e.brand_color);if(r.isValid()){var o=r.isLight()?r.mix("#000",.85):r.mix("#fff",.85);t["--email_header_text_color"]=o.toHex()}return t},testImage:function(e){return new Promise((function(t){var i=new Image;i.src=e,i.onload=function(){return t(!0)},i.onerror=function(){return t(!1)}}))}});function ce(e){return ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ce(e)}function ue(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function de(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=ce(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=ce(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ce(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var he=Backbone.View.extend({className:"gl-tr",criteria:["conditions"],editor:null,main:null,multibox:["recipients"],template:wp.template("glsrn-notification"),tinymce:null,tippy:[],templates:{uid:"glsrn-field-uid",subject:"glsrn-field-subject",heading:"glsrn-field-heading",message:"glsrn-field-message",recipients:"glsrn-field-recipients",conditions:"glsrn-field-conditions",schedule:"glsrn-field-schedule",enabled:"glsrn-field-enabled"},events:{"change input[type=checkbox]":"onChange","change select":"onChange","click a.toggle-field":"onToggle","click button.delete":"onRemove","click button.save":"onSave","click button.test":"onSendTestEmail",click:"onViewClick",keydown:"onViewKeydown","keyup input":"onChange","keyup textarea":"onChange",keyup:"onViewKeyup"},initialize:function(e){_.extend(this,_.pick(e,"main")),this.listenTo(this,"init:editor",this.initEditor),this.listenTo(this,"init:tippy",this.initTippy),this.listenTo(this.model,"change",this.refresh),this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model,"model:expand",this.expand),this.listenTo(this.model,"model:collapse",this.collapse),this.listenTo(this.model,"model:validate",this.validate),this.listenTo(this.model,"model:validate:reset",this.resetValidation)},render:function(){var e=this,t=this.prepareAttributes();this.$el.html(this.template(t));var i=this.$(h.selector("settings"));return _.each(this.templates,(function(n,r){i.append(wp.template(n)(t)),-1!==_.indexOf(e.criteria,r)&&e.loadCriteria(r),-1!==_.indexOf(e.multibox,r)&&e.loadMultibox(r)})),i.append(wp.template("glsrn-field-actions")()),this},collapse:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.model.expanded)return this.model.toggle(!1),this.$(h.selector("settings")).slideUp(100,"linear").promise().then((function(){e.$el.removeClass(h.classes.expanded),t&&e.validate()}))},collapseAll:function(){this.main.collection.each((function(e){return e.trigger("model:collapse")}))},expand:function(){if(!this.model.expanded)return this.model.toggle(!0),this.$el.addClass(h.classes.expanded),this.$(h.selector("settings")).slideDown(100,"linear").promise()},initEditor:function(){var e=this,t=this.$("textarea.wp-editor-area");this.tinymce=t.attr("id"),wp.editor.initialize(this.tinymce,{quicktags:{buttons:"strong,em,link,ul,ol,li"},tinymce:{init_instance_callback:function(i){e.initPreview(),i.execCommand("wpAutoResizeOn"),i.on("Paste Change input Undo Redo",_.debounce(e.onEditorChange.bind(e,i,t),250)),i.$(document).on("click",e.onPreview.bind(e))},block_formats:"Paragraph=p;Header 2=h2;Header 3=h3;Header 4=h4",paste_retain_style_properties:"",paste_word_valid_elements:"-strong/b,-em/i,-u,-p,-ol,-ul,-li,-h2,-h3,-h4,-a[href|name],sub,sup,strike,del",toolbar1:"formatselect bold italic forecolor bullist numlist link removeformat"}})},initPreview:function(){var e=this.$el.find(".wp-editor-tools"),t=jQuery("<button>").attr({class:"wp-switch-to-preview switch-preview",type:"button"}),i=new le({main:this.main,model:this.model});e.find(".wp-editor-tabs").append(t.text(window.tinymce.translate("Preview"))),e.find(".wp-editor-container").append(i.render().el)},initTippy:function(){this.tippy=GLSR.Tippy.tippy(this.el.querySelectorAll("[data-tippy-content]"),{appendTo:function(){return document.body},delay:[200,null],offset:[-50,10],placement:"top-start"})},loadCriteria:function(e){var t=this.$(h.selector("criteria"));new w({el:t,key:e,model:this.model}).render()},loadMultibox:function(e){var t=this.$(h.selector("mb")),i=_.map(n.recipients,(function(e,t){return{name:e,slug:t}}));new C({el:t,options:i,key:e,model:this.model}).render()},onChange:function(e){if(!~["ArrowDown","ArrowUp","Tab"].indexOf(e.key)){var t=e.currentTarget,i=t.dataset.field;if(!_.isEmpty(i)){var n=~["checkbox","radio"].indexOf(t.type)?t.checked:t.value;this.model.trigger("model:validate:reset",t),this.model.set(i,n,{silent:!0}),this.model.trigger("model:change")}}},onEditorChange:function(e,t){var i=e.getContent();i!==e._lastChange&&(e._lastChange=i,this.model.trigger("model:validate:reset",t),this.model.set("message",i,{silent:!0}),this.model.trigger("model:change"))},onPreview:function(e){var t=this.$(e.target),i=t.hasClass("wp-switch-to-preview");if(t.hasClass("wp-switch-editor")||i){var n=this.$(".wp-editor-wrap");if(i){var r=tinymce.get(this.tinymce);r&&r.isHidden()&&window.QTags.closeAllTags(this.tinymce),n.addClass(h.classes.preview_active)}else n.removeClass(h.classes.preview_active)}},onRemove:function(e){var t=this;e.preventDefault(),window.confirm(wp.i18n._x("Are you sure you want to delete this notification?","admin-text","site-reviews-notifications"))&&this.$el.addClass(h.classes.removing).fadeOut(350,(function(){t.tearDown(),t.model.destroy()}))},onSave:function(e){var t=this;if(e.preventDefault(),this.validate()){var i=this.model.get("enabled")?"addClass":"removeClass";this.$el[i](h.classes.active);var n=this.collapse(!1);n&&n.done((function(){return t.model.trigger("change")}))}},onSendTestEmail:function(e){e.preventDefault();e.currentTarget;if(this.validate()){var t=function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ue(Object(i),!0).forEach((function(t){de(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ue(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({_action:"send-test-notification"},this.model.toJSON());new GLSR.ajax(t,e).post()}},onToggle:function(e){var t=this;e.preventDefault(),this.model.toggle(),this.$(h.selector("settings")).slideToggle(100,"linear").promise().done((function(){tinymce.get(t.tinymce).execCommand("wpAutoResize")})),this.validate()},onViewClick:function(e){this.model.trigger("model:click",e)},onViewKeydown:function(e){"Enter"===e.key&&"TEXTAREA"!==e.target.nodeName&&e.preventDefault(),this.model.trigger("model:keydown",e)},onViewKeyup:function(e){this.model.trigger("model:keyup",e)},refresh:function(){this.tearDown(),this.render(),this.trigger("init:tippy"),this.trigger("init:editor")},prepareAttributes:function(){var e,t=this.model.toJSON();if(t.addon=n,t.cid=this.model.cid,t.recipients.length>1)t.selected_recipients=wp.i18n._x("Multiple Recipients","admin-text","site-reviews-notifications");else{var i,r=(null===(i=t.recipients)||void 0===i?void 0:i[0])||wp.i18n._x("None","admin-text","site-reviews-notifications");t.selected_recipients=_.get(n.recipients,r,r)}return t.selected_schedule=null===(e=n.schedule)||void 0===e?void 0:e[t.schedule],t},resetValidation:function(e){var t=this.$(e).closest(h.selector("field"));t.find(h.selector("invalid")).removeClass(h.classes.invalid),t.find(h.selector("error")).remove()},tearDown:function(){_.each(this.tippy,(function(e){return e.destroy()})),wp.editor.remove(this.tinymce)},validate:function(){var e=this;return this.model.isValid()?(this.$el.removeClass(h.classes.invalid),!0):(this.$el.addClass(h.classes.invalid),_.each(this.model.errors,(function(t,i){var n=e.$("[data-field="+i+"]");e.model.trigger("model:validate:reset",n),n.addClass(h.classes.invalid).closest(h.selector("input")).append(wp.template("glsrn-field-error")({error:t}))})),!1)}}),fe=he,pe=Backbone.View.extend({el:"#glsrn",collection:null,data:[],settings:{background_color:"",body_background_color:"",body_link_color:"",body_text_color:"",brand_color:"",footer_text:"",header_image:""},events:{"click button.add-notification":"create"},initialize:function(e){this.el&&(_.extend(this,_.pick(e,"addon")),this.data=n.data,this.collection=new d,this.collection.add(this.data),this.render(),this.listenTo(this.collection,"add",this.insert),this.listenTo(this.collection,"all",_.debounce(this.refresh,50)),this.monitorSettings())},render:function(){return this.$(h.selector("notifications")).html(""),this.collection.length&&this.collection.each(this.insert,this),this.refresh(),this},create:function(e){e.preventDefault();var t=new u;this.collection.each((function(e){return e.trigger("model:collapse")})),this.collection.add(t),t.trigger("model:expand")},insert:function(e){var t=new fe({main:this,model:e});this.$(h.selector("notifications")).append(t.render().el),this.$(h.selector("placeholder")).remove(),t.trigger("init:tippy"),t.trigger("init:editor")},insertFallback:function(){this.collection.length||this.$(h.selector("notifications")).html(wp.template("glsrn-notification-empty")())},monitorSettings:function(){var e=this;_.each(_.keys(this.settings),(function(t){var i=jQuery('[data-name="'+t+'"]'),n=i[0].nodeName;e.settings[t]=i.val(),"INPUT"===n&&i.on("change",_.debounce((function(i){e.settings[t]=i.target.value,e.trigger("preview:render")}),100)),"TEXTAREA"===n&&i.on("keyup",_.debounce((function(i){e.settings[t]=i.target.value,e.trigger("preview:render")}),100))}))},refresh:function(e){if(!~["model:click","model:keydown","model:keyup"].indexOf(e)&&"invalid"!==e){var t=[];this.collection.each((function(e){e.isValid({silent:!0})&&t.push(e.toJSON())})),this.insertFallback(),this.$el.find("#glsrn-data").val(h.encode(t)),this.data=t}}});jQuery((function(e){return n.ui=new pe}))},583:function(){}},i={};function n(e){var r=i[e];if(void 0!==r)return r.exports;var o=i[e]={exports:{}};return t[e](o,o.exports,n),o.exports}n.m=t,e=[],n.O=function(t,i,r,o){if(!i){var s=1/0;for(u=0;u<e.length;u++){i=e[u][0],r=e[u][1],o=e[u][2];for(var a=!0,l=0;l<i.length;l++)(!1&o||s>=o)&&Object.keys(n.O).every((function(e){return n.O[e](i[l])}))?i.splice(l--,1):(a=!1,o<s&&(s=o));if(a){e.splice(u--,1);var c=r();void 0!==c&&(t=c)}}return t}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[i,r,o]},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={859:0,893:0};n.O.j=function(t){return 0===e[t]};var t=function(t,i){var r,o,s=i[0],a=i[1],l=i[2],c=0;if(s.some((function(t){return 0!==e[t]}))){for(r in a)n.o(a,r)&&(n.m[r]=a[r]);if(l)var u=l(n)}for(t&&t(i);c<s.length;c++)o=s[c],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(u)},i=self.webpackChunk=self.webpackChunk||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}(),n.O(void 0,[893],(function(){return n(257)}));var r=n.O(void 0,[893],(function(){return n(583)}));r=n.O(r)}();